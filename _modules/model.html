

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>model &mdash; AIMS 2.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=b21de401"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AIMS
              <img src="../_static/AIMS_logo_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../project.html">Project Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download <code class="docutils literal notranslate"><span class="pre">AIMS</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formats.html">File formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">List of changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AIMS.html">The <code class="docutils literal notranslate"><span class="pre">AIMS</span></code> program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model.html">The <code class="docutils literal notranslate"><span class="pre">model</span></code> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../constants.html">The <code class="docutils literal notranslate"><span class="pre">constants</span></code> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">The <code class="docutils literal notranslate"><span class="pre">functions</span></code> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities.html">The <code class="docutils literal notranslate"><span class="pre">utilities</span></code> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_interpolation_test.html">The <code class="docutils literal notranslate"><span class="pre">plot_interpolation_test</span></code> tool</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AIMS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">model</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for model</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>
<span class="c1"># $Id: model.py</span>
<span class="c1"># Author: Daniel R. Reese &lt;daniel.reese@obspm.fr&gt;</span>
<span class="c1"># Copyright (C) Daniel R. Reese and contributors</span>
<span class="c1"># Copyright license: GNU GPL v3.0</span>
<span class="c1">#</span>
<span class="c1">#   AIMS is free software: you can redistribute it and/or modify</span>
<span class="c1">#   it under the terms of the GNU General Public License as published by</span>
<span class="c1">#   the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">#   (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1">#   This program is distributed in the hope that it will be useful,</span>
<span class="c1">#   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#   GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#   You should have received a copy of the GNU General Public License</span>
<span class="c1">#   along with AIMS.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module which contains various classes relevant to the grid of models:</span>

<span class="sd">- :py:class:`Model`: a model</span>
<span class="sd">- :py:class:`Track`: an evolutionary track</span>
<span class="sd">- :py:class:`Model_grid`: a grid of models</span>

<span class="sd">These different classes allow the program to store a grid of models and perform</span>
<span class="sd">a number of operations, such as:</span>

<span class="sd">- retrieving model properties</span>
<span class="sd">- interpolate within the grid models</span>
<span class="sd">- sort the models within a given evolutionary track</span>
<span class="sd">- ...</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;restructuredtext&#39;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="c1"># AIMS configuration:</span>
<span class="k">if</span> <span class="s1">&#39;AIMS_configure.py&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">]</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">AIMS_configure</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">config</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AIMS_configure.py path in model.py: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="vm">__file__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># packages from within AIMS:</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">constants</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">utilities</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aims_fortran</span>

<span class="c1"># various packages needed for AIMS</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>

<span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial</span><span class="w"> </span><span class="kn">import</span> <span class="n">Delaunay</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bisect</span><span class="w"> </span><span class="kn">import</span> <span class="n">bisect_right</span>

<span class="c1"># maximum filename length</span>
<span class="c1"># filename_dtype = &quot;U1000&quot;</span>
<span class="n">filename_dtype</span> <span class="o">=</span> <span class="s2">&quot;str&quot;</span>

<span class="c1"># Strings for age parameters</span>
<span class="n">age_str</span> <span class="o">=</span> <span class="s2">&quot;Age&quot;</span>
<span class="sd">&quot;&quot;&quot; Name of the physical age parameter used in the interpolation &quot;&quot;&quot;</span>

<span class="n">age_adim_str</span> <span class="o">=</span> <span class="s2">&quot;Age_adim&quot;</span>
<span class="sd">&quot;&quot;&quot; Name of the non-dimensional age parameter used in the interpolation &quot;&quot;&quot;</span>

<span class="c1"># Global parameters:</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="sd">&quot;&quot;&quot; tolerance level for points slightly outside the grid &quot;&quot;&quot;</span>

<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="sd">&quot;&quot;&quot; relative tolerance on parameters used for setting up evolutionary tracks &quot;&quot;&quot;</span>

<span class="n">log0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e150</span>
<span class="sd">&quot;&quot;&quot; value which is returned when log(0) is calculated (rather than causing an error) &quot;&quot;&quot;</span>

<span class="n">ntype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span>
<span class="sd">&quot;&quot;&quot; type used for the n values &quot;&quot;&quot;</span>

<span class="n">ltype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span>  <span class="c1"># int8 ranges from -128 to 127</span>
<span class="sd">&quot;&quot;&quot; type used for the l values &quot;&quot;&quot;</span>

<span class="n">ftype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<span class="sd">&quot;&quot;&quot;  type used for the frequencies &quot;&quot;&quot;</span>

<span class="n">gtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<span class="sd">&quot;&quot;&quot; type used for grid data &quot;&quot;&quot;</span>

<span class="n">modetype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">ntype</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="n">ltype</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="n">ftype</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;inertia&#39;</span><span class="p">,</span> <span class="n">ftype</span><span class="p">)]</span>
<span class="sd">&quot;&quot;&quot; structure for modes &quot;&quot;&quot;</span>

<span class="c1"># quantities related to user-defined parameters:</span>
<span class="n">user_params_index</span> <span class="o">=</span> <span class="p">{}</span>
<span class="sd">&quot;&quot;&quot; dictionary which will supply the appropriate index for the user-defined parameters&quot;&quot;&quot;</span>

<span class="n">user_params_latex</span> <span class="o">=</span> <span class="p">{}</span>
<span class="sd">&quot;&quot;&quot; dictionary which will supply the appropriate latex name for the user-defined parameters&quot;&quot;&quot;</span>

<span class="c1"># integer indices for various global quantities which will be stored in a np array:</span>
<span class="n">nglb</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot; total number of global quantities in a model (see :py:data:`Model.glb`).&quot;&quot;&quot;</span>

<span class="n">nlin</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">total number of global quantities which are interpolated in a linear way (see</span>
<span class="sd">:py:func:`combine_models`).  These quantities are numbered 0:nlin-1</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">iage_adim</span> <span class="o">=</span> <span class="mi">0</span>
<span class="sd">&quot;&quot;&quot; index of the parameter corresponding to dimensionless age in the :py:data:`Model.glb` array &quot;&quot;&quot;</span>

<span class="n">iage</span> <span class="o">=</span> <span class="mi">1</span>
<span class="sd">&quot;&quot;&quot; index of the parameter corresponding to age in the :py:data:`Model.glb` array &quot;&quot;&quot;</span>

<span class="n">imass</span> <span class="o">=</span> <span class="mi">2</span>
<span class="sd">&quot;&quot;&quot; index of the parameter corresponding to mass in the :py:data:`Model.glb` array &quot;&quot;&quot;</span>

<span class="n">itemperature</span> <span class="o">=</span> <span class="mi">3</span>
<span class="sd">&quot;&quot;&quot; index of the parameter corresponding to temperature in the :py:data:`Model.glb` array &quot;&quot;&quot;</span>

<span class="n">iz0</span> <span class="o">=</span> <span class="mi">4</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">index of the parameter corresponding to the initial metallicity</span>
<span class="sd">the :py:data:`Model.glb` array</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">ix0</span> <span class="o">=</span> <span class="mi">5</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">index of the parameter corresponding to the initial hydrogen content</span>
<span class="sd">in the :py:data:`Model.glb` array</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">ifreq_ref</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">index of the parameter corresponding to the reference frequency</span>
<span class="sd">(used to non-dimensionalise the pulsation frequencies of the model)</span>
<span class="sd">in the :py:data:`Model.glb` array</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">iradius</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot; index of the parameter corresponding to radius in the :py:data:`Model.glb` array &quot;&quot;&quot;</span>

<span class="n">iluminosity</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot; index of the parameter corresponding to luminosity in the :py:data:`Model.glb` array &quot;&quot;&quot;</span>


<div class="viewcode-block" id="string_to_latex">
<a class="viewcode-back" href="../model.html#model.string_to_latex">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">string_to_latex</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a fancy latex name for an input string.</span>
<span class="sd">    </span>
<span class="sd">    :param string: string that indicates for which parameter we&#39;re seeking a latex name</span>
<span class="sd">    :param prefix: optional prefix to add to the string</span>
<span class="sd">    :param postfix: optional postfix to add to the string</span>

<span class="sd">    :type string: string</span>
<span class="sd">    :type prefix: string</span>
<span class="sd">    :type postfix: string</span>

<span class="sd">    :return: a fancy latex name</span>
<span class="sd">    :rtype: string</span>

<span class="sd">    .. note::</span>
<span class="sd">      This also works for the names of the amplitude parameters for surface corrections.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;log_&quot;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">string_to_latex</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">prefix</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\log_</span><span class="si">{10}</span><span class="s2">\left(&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\right)&quot;</span> <span class="o">+</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ln_&quot;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">string_to_latex</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span> <span class="n">prefix</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\ln\left(&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\right)&quot;</span> <span class="o">+</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;exp_&quot;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">string_to_latex</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">prefix</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\exp\left(&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\right)&quot;</span> <span class="o">+</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Mass&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Mass, $</span><span class="si">%s</span><span class="s1">M/M_{\odot}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Radius&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Radius, $</span><span class="si">%s</span><span class="s1">R/R_{\odot}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Luminosity&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Luminosity, $</span><span class="si">%s</span><span class="s1">L/L_{\odot}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Metallicity, $</span><span class="si">%s</span><span class="s1">Z_0</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Helium content, $</span><span class="si">%s</span><span class="s1">Y_0</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Hydrogen content, $</span><span class="si">%s</span><span class="s1">X_0</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Ys&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Helium content, $</span><span class="si">%s</span><span class="s1">Y_s</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Yc&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Central helium, $</span><span class="si">%s</span><span class="s1">Y_s</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;zsx_s&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Ratio, $</span><span class="si">%s</span><span class="s1">(Z/X)_s</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;zsx_0&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Ratio, $</span><span class="si">%s</span><span class="s1">(Z/X)_0</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Fe_H&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Iron content, $</span><span class="si">%s</span><span class="s1">\mathrm{[Fe/H]}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Fe_H0&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Initial iron content, $</span><span class="si">%s</span><span class="s1">\mathrm{[Fe/H]}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;M_H&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Metal content, $</span><span class="si">%s</span><span class="s1">\mathrm{[M/H]}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;M_H0&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Initial metal content, $</span><span class="si">%s</span><span class="s1">\mathrm{[M/H]}_0</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;dY_dZ&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Enrichment law, $</span><span class="si">%s</span><span class="s1">\mathrm{dY/dZ}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="n">age_str</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Age (in Myrs), $</span><span class="si">%s</span><span class="s1">t</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="n">age_adim_str</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Age parameter, $</span><span class="si">%s</span><span class="s1">\tau</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Teff&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">T_{\mathrm</span><span class="si">{eff}</span><span class="s1">}</span><span class="si">%s</span><span class="s1">$ (in K)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Dnu&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Large separation (in $\mu$Hz), $</span><span class="si">%s</span><span class="s1">\Delta \nu</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;numax&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">\nu_{\mathrm</span><span class="si">{max}</span><span class="s1">}</span><span class="si">%s</span><span class="s1">$ (in $\mu$Hz)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Rho&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Density (in g.cm$^{-3}$), $</span><span class="si">%s</span><span class="s1">\rho</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;g&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;Surface gravity (in cm.s$^{-2}$), $</span><span class="si">%s</span><span class="s1">g</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Theta_BCZ&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;BCZ normalised acoustic depth, $</span><span class="si">%s</span><span class="s1">\tau_{\mathrm</span><span class="si">{BCZ}</span><span class="s1">}/2\tau</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Theta_He&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;HeII normalised acoustic depth, $</span><span class="si">%s</span><span class="s1">\tau_{\mathrm</span><span class="si">{He}</span><span class="s1">}/2\tau</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;A_surf&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">A_{\mathrm</span><span class="si">{surf}</span><span class="s1">}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;A3_surf&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">A_3^{\mathrm</span><span class="si">{surf}</span><span class="s1">}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Am1_surf&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">A_{-1}^{\mathrm</span><span class="si">{surf}</span><span class="s1">}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;alpha_surf&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">\alpha_{\mathrm</span><span class="si">{surf}</span><span class="s1">}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;b_Kjeldsen2008&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">b_{\mathrm{Kjeldsen\,et\,al.\,(2008)}}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;beta_Sonoi2015&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">\beta_{\mathrm{Sonoi\,et\,al.\,(2015)}}</span><span class="si">%s</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span>

    <span class="c1"># raises a KeyError if `string` isn&#39;t a valid key</span>
    <span class="k">return</span> <span class="n">user_params_latex</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">postfix</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_surface_parameter_names">
<a class="viewcode-back" href="../model.html#model.get_surface_parameter_names">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_surface_parameter_names</span><span class="p">(</span><span class="n">surface_option</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the relevant parameter names for a given surface correction option.</span>

<span class="sd">    :param surface_option: specifies the type of surface correction.</span>
<span class="sd">    :type surface_option: string</span>

<span class="sd">    :return: names for the surface parameters</span>
<span class="sd">    :rtype: tuple of strings</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Kjeldsen2008&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;A_surf&quot;</span><span class="p">,)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Kjeldsen2008_scaling&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;A_surf&quot;</span><span class="p">,)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Kjeldsen2008_2&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;A_surf&quot;</span><span class="p">,</span> <span class="s2">&quot;b_Kjeldsen2008&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Ball2014&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;A3_surf&quot;</span><span class="p">,)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Ball2014_2&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;A3_surf&quot;</span><span class="p">,</span> <span class="s2">&quot;Am1_surf&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Sonoi2015&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;alpha_surf&quot;</span><span class="p">,)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Sonoi2015_scaling&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;alpha_surf&quot;</span><span class="p">,)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Sonoi2015_2&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;alpha_surf&quot;</span><span class="p">,</span> <span class="s2">&quot;beta_Sonoi2015&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown surface correction: &quot;</span> <span class="o">+</span> <span class="n">surface_option</span><span class="p">)</span></div>



<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../model.html#model.Model">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class which contains a stellar model, including classical and seismic information.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Model.string_to_param">
<a class="viewcode-back" href="../model.html#model.Model.string_to_param">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">string_to_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a parameter for an input string.</span>
<span class="sd">        </span>
<span class="sd">        :param string: string that indicates which parameter we&#39;re seeking</span>
<span class="sd">        :type string: string</span>

<span class="sd">        :return: the value of the parameter</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;log_&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">4</span><span class="p">:]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ln_&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">3</span><span class="p">:]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;exp_&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">4</span><span class="p">:]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Mass&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_mass</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Radius&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_radius</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Luminosity&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iluminosity</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_luminosity</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iz0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iz0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ix0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ix0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Ys&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Zs&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Xs&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Yc&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Zc&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Xc&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;zsx_s&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zsx_s</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;zsx_0&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zsx_0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Fe_H&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FeH</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Fe_H0&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FeH0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;M_H&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MH</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;M_H0&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MH0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;dY_dZ&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iz0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ix0</span><span class="p">]</span> <span class="o">-</span> <span class="n">constants</span><span class="o">.</span><span class="n">Yp</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iz0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="n">age_str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iage</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="n">age_adim_str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iage_adim</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Teff&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">itemperature</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Dnu&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_large_separation</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;numax&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">numax</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Rho&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;g&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">constants</span><span class="o">.</span><span class="n">G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Theta_BCZ&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;tau_BCZ&quot;</span><span class="p">]]</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;tau&quot;</span><span class="p">]])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Theta_He&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;tau_He&quot;</span><span class="p">]]</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;tau&quot;</span><span class="p">]])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;beta_Sonoi2015&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_Sonoi2015</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;b_Kjeldsen2008&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_Kjeldsen2008</span>

        <span class="c1"># raises a KeyError if `string` isn&#39;t a valid key</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="n">string</span><span class="p">]]</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_glb</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_modes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param _glb: 1D array of global parameters for this model.  Its dimension should</span>
<span class="sd">          be greater or equal to :py:data:`nglb`</span>
<span class="sd">        :param _name: name of the model (typically the second part of its path)</span>
<span class="sd">        :param _modes: list of modes in the form of tuples</span>
<span class="sd">          (n,l,freq,inertia) which will be appended to the set of modes in the model.</span>

<span class="sd">        :type _glb: np.array</span>
<span class="sd">        :type _name: string</span>
<span class="sd">        :type _modes: list of (int, int, float, float)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check inputs</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">_glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">),</span> <span class="s2">&quot;A star cannot have a negative mass!&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">_glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">),</span> <span class="s2">&quot;A star cannot have a negative radius!&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">_glb</span><span class="p">[</span><span class="n">iluminosity</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">),</span> <span class="s2">&quot;A star cannot have a negative luminosity!&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">_glb</span><span class="p">[</span><span class="n">iz0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">),</span> <span class="s2">&quot;A star cannot have a negative metallicity!&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">_glb</span><span class="p">[</span><span class="n">ix0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">),</span> <span class="s2">&quot;A star cannot have a negative hydrogen abundance!&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">_glb</span><span class="p">[</span><span class="n">iage</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">),</span> <span class="s2">&quot;A star cannot have a negative age!&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">_glb</span><span class="p">[</span><span class="n">itemperature</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">),</span> <span class="s2">&quot;A star cannot have a negative temperature!&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">_name</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the model, typically the second part of its path&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">glb</span> <span class="o">=</span> <span class="n">_glb</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Array which will contain various global quantities&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5e5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Characteristic frequency of the model in :math:`\\mathrm{cyclic \\, \\mu Hz}`&quot;&quot;&quot;</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;array containing the modes (n, l, freq, inertia)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_modes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_modes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears a model instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<div class="viewcode-block" id="Model.read_file">
<a class="viewcode-back" href="../model.html#model.Model.read_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a set of modes from a file.  This method will either call</span>
<span class="sd">        :py:meth:`read_file_CLES`, :py:meth:`read_file_MESA`, or</span>
<span class="sd">        :py:meth:`read_file_agsm` according to the value of the ``mode_format``</span>
<span class="sd">        variable in ``AIMS_configure.py``.</span>

<span class="sd">        :param filename: name of the file with the modes. The format of this file</span>
<span class="sd">                         is decided by the ``mode_format`` variable in</span>
<span class="sd">                         ``AIMS_configure.py``.</span>

<span class="sd">        :type filename: string</span>

<span class="sd">        :return: ``True`` if at least one frequency has been discarded (see note below).</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. note::</span>
<span class="sd">          At this stage the frequencies should be expressed in :math:`\\mu\\mathrm{Hz}`.</span>
<span class="sd">          They will be non-dimensionalised in :py:func:`read_model_list_standard`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">mode_format</span> <span class="o">==</span> <span class="s2">&quot;simple&quot;</span><span class="p">):</span>  <span class="c1"># for retrocompatibility</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file_CLES</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">mode_format</span> <span class="o">==</span> <span class="s2">&quot;CLES&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file_CLES</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">mode_format</span> <span class="o">==</span> <span class="s2">&quot;CLES_Mod&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file_CLES_Mod</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">mode_format</span> <span class="o">==</span> <span class="s2">&quot;MESA&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file_MESA</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">mode_format</span> <span class="o">==</span> <span class="s2">&quot;agsm&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file_agsm</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">mode_format</span> <span class="o">==</span> <span class="s2">&quot;PLATO&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file_PLATO</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognised format </span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">mode_format</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                         <span class="s2">&quot;Please choose another value for mode_format in AIMS_configure.py&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model.read_file_CLES">
<a class="viewcode-back" href="../model.html#model.Model.read_file_CLES">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_file_CLES</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a set of modes from a file.  This uses the &quot;simple&quot; or &quot;CLES&quot;</span>
<span class="sd">        format as specified in the ``mode_format`` variable in ``AIMS_configure.py``.</span>

<span class="sd">        :param filename: name of the file with the modes.</span>
<span class="sd">          The file should contain a one-line header followed by five</span>
<span class="sd">          columns which correspond to l, n, frequency, unused, inertia.</span>

<span class="sd">        :type filename: string</span>

<span class="sd">        :return: ``True`` if at least one frequency has been discarded (see note below).</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. note::</span>
<span class="sd">          - The fourth column is discarded.</span>
<span class="sd">          - Frequencies above `config.cutoff` * :math:`\\nu_{\\mathrm{cut-off}}` are discarded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">freqlim</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span>
        <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">freqfile</span><span class="p">:</span>
            <span class="n">freqfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>  <span class="c1"># skip head</span>
            <span class="n">mode_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">freqfile</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="c1"># remove frequencies above AIMS_configure.cutoff*nu_{cut-off}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="n">freqlim</span><span class="p">):</span>
                    <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">npositive</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)):</span>  <span class="c1"># remove g-modes if need be</span>
                    <span class="k">continue</span>
                <span class="n">mode_temp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">freq</span><span class="p">,</span> <span class="n">utilities</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">])))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode_temp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">exceed_freqlim</span></div>


<div class="viewcode-block" id="Model.read_file_CLES_Mod">
<a class="viewcode-back" href="../model.html#model.Model.read_file_CLES_Mod">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_file_CLES_Mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a set of modes from a file.  This uses the &quot;CLES_Mod&quot; format as</span>
<span class="sd">        specified in the ``mode_format`` variable in ``AIMS_configure.py``.</span>

<span class="sd">        :param filename: name of the file with the modes.</span>
<span class="sd">          The file may contain a header (the header lines start with &quot;#&quot;)</span>
<span class="sd">          followed by four columns which correspond to l, n, unused, frequency.</span>

<span class="sd">        :type filename: string</span>

<span class="sd">        :return: ``True`` if at least one frequency has been discarded (see note below).</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. note::</span>
<span class="sd">          - The third column is discarded.</span>
<span class="sd">          - Frequencies above `config.cutoff` * :math:`\\nu_{\\mathrm{cut-off}}` are discarded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">freqlim</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span>
        <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">freqfile</span><span class="p">:</span>
            <span class="n">mode_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">freqfile</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>  <span class="c1"># Skip comments</span>
                    <span class="k">continue</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span>  <span class="c1"># freq tu muHz</span>
                <span class="c1"># remove frequencies above AIMS_configure.cutoff*nu_{cut-off}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="n">freqlim</span><span class="p">):</span>
                    <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">npositive</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)):</span>  <span class="c1"># remove g-modes if need be</span>
                    <span class="k">continue</span>
                <span class="n">mode_temp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">freq</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>  <span class="c1"># No inertia in file</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode_temp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">exceed_freqlim</span></div>


<div class="viewcode-block" id="Model.read_file_MESA">
<a class="viewcode-back" href="../model.html#model.Model.read_file_MESA">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_file_MESA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a set of modes from a file.  This uses the GYRE (i.e. MESA) format as</span>
<span class="sd">        specified in the ``mode_format`` variable in ``AIMS_configure.py``.</span>

<span class="sd">        :param filename: name of the file with the modes.</span>
<span class="sd">          The file should contain a seven-line header followed by various</span>
<span class="sd">          columns which contain l, n, frequency, and inertia for each pulsation</span>
<span class="sd">          mode.</span>

<span class="sd">        :type filename: string</span>

<span class="sd">        :return: ``True`` if at least one frequency has been discarded (see note below).</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. note::</span>
<span class="sd">          - Frequencies above `config.cutoff` * :math:`\\nu_{\\mathrm{cut-off}}` are discarded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">freqlim</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span>
        <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">freqfile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">freqfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">mode_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">freqfile</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># n_pg</span>
                <span class="c1"># n = int(columns[2])  # n_p</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="c1"># remove frequencies above AIMS_configure.cutoff*nu_{cut-off}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="n">freqlim</span><span class="p">):</span>
                    <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">npositive</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)):</span>  <span class="c1"># remove g-modes if need be</span>
                    <span class="k">continue</span>
                <span class="n">mode_temp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">freq</span><span class="p">,</span> <span class="n">utilities</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">7</span><span class="p">])))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode_temp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">exceed_freqlim</span></div>


<div class="viewcode-block" id="Model.read_file_agsm">
<a class="viewcode-back" href="../model.html#model.Model.read_file_agsm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_file_agsm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a set of modes from a file.  This uses the &quot;agsm&quot; format as</span>
<span class="sd">        specified in the ``mode_format`` variable in ``AIMS_configure.py``.</span>

<span class="sd">        :param filename: name of the file with the modes. This file is a</span>
<span class="sd">            binary fortran &quot;agsm&quot; file produced by the ADIPLS code.  See</span>
<span class="sd">            instructions to the ADIPLS code for a description of this</span>
<span class="sd">            format.</span>

<span class="sd">        :type filename: string</span>

<span class="sd">        :return: ``True`` if at least one frequency has been discarded (see note below).</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. note::</span>
<span class="sd">          - Frequencies above `config.cutoff` * :math:`\\nu_{\\mathrm{cut-off}}` are discarded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">narr</span><span class="p">,</span> <span class="n">larr</span><span class="p">,</span> <span class="n">farr</span><span class="p">,</span> <span class="n">iarr</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">exceed_freqlim</span> <span class="o">=</span> \
            <span class="n">aims_fortran</span><span class="o">.</span><span class="n">read_file_agsm</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">npositive</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">agsm_cutoff</span><span class="p">,</span> \
                                        <span class="n">config</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">narr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nn</span><span class="p">],</span> <span class="n">larr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nn</span><span class="p">],</span> <span class="n">farr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nn</span><span class="p">],</span> <span class="n">iarr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nn</span><span class="p">])),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">exceed_freqlim</span></div>


<div class="viewcode-block" id="Model.read_file_PLATO">
<a class="viewcode-back" href="../model.html#model.Model.read_file_PLATO">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_file_PLATO</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a set of modes from a file.  This uses the &quot;PLATO&quot; format as</span>
<span class="sd">        specified in the ``mode_format`` variable in ``AIMS_configure.py``.</span>

<span class="sd">        :param filename: name of the file with the modes.</span>
<span class="sd">          The file may contain a header (the header lines start with &quot;#&quot;)</span>
<span class="sd">          followed by four columns which correspond to l, n, frequency, inertia.</span>

<span class="sd">        :type filename: string</span>

<span class="sd">        :return: ``False``</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. note::</span>
<span class="sd">          - No mode selection is carried out, hence the return value</span>
<span class="sd">          - np.loadtxt is used to gain speed (the grid is quite large)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Model.read_modes_Aldo">
<a class="viewcode-back" href="../model.html#model.Model.read_modes_Aldo">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_modes_Aldo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">norder</span><span class="p">,</span> <span class="n">farray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a set of modes from a table.  This uses the Aldo format as</span>
<span class="sd">        specified in the ``mode_format`` variable in ``AIMS_configure.py``.</span>

<span class="sd">        :param norder: table which gives the starting n values and number of modes</span>
<span class="sd">                       per l value</span>
<span class="sd">        :type norder: 2D numpy int array</span>

<span class="sd">        :param farray: table with mode frequencies and inertias as follows:</span>
<span class="sd">          frequency1, inertia1, frequency2, inertia2 ...</span>
<span class="sd">        :type farray: 1D numpy float array</span>

<span class="sd">        :return: ``True`` if at least one frequency has been discarded (see note below).</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. note::</span>
<span class="sd">          - Frequencies above `config.cutoff` * :math:`\\nu_{\\mathrm{cut-off}}` are discarded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">freqlim</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span>
        <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">mode_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">norder</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">norder</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="n">farray</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

                <span class="c1"># remove zero freuqency modes (these modes are not calculated):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">):</span>
                    <span class="n">ii</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="k">continue</span>

                <span class="c1"># remove frequencies above AIMS_configure.cutoff*nu_{cut-off}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="n">freqlim</span><span class="p">):</span>
                    <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">ii</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="k">continue</span>

                <span class="c1"># remove gravity modes if need be</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">npositive</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)):</span>
                    <span class="n">ii</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="k">continue</span>

                <span class="c1"># we can add this mode:</span>
                <span class="n">mode_temp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">farray</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode_temp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">)</span>
                <span class="n">ii</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">exceed_freqlim</span></div>


<div class="viewcode-block" id="Model.write_file_simple">
<a class="viewcode-back" href="../model.html#model.Model.write_file_simple">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_file_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a set of modes into a file using the &quot;simple&quot; format as</span>
<span class="sd">        described in :py:meth:`read_file_simple`.</span>

<span class="sd">        :param filename: name of the file where the modes should</span>
<span class="sd">                         be written.</span>

<span class="sd">        :type filename: string</span>

<span class="sd">        .. note::</span>
<span class="sd">          - The output frequencies are expressed in :math:`\\mathrm{\\mu Hz}`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="c1"># write header</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# </span><span class="si">%1s</span><span class="s2"> </span><span class="si">%3s</span><span class="s2"> </span><span class="si">%22s</span><span class="s2"> </span><span class="si">%6s</span><span class="s2"> </span><span class="si">%22s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;nu_theo (muHz)&quot;</span><span class="p">,</span> <span class="s2">&quot;unused&quot;</span><span class="p">,</span> <span class="s2">&quot;Inertia&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%1d</span><span class="s2"> </span><span class="si">%3d</span><span class="s2"> </span><span class="si">%22.15e</span><span class="s2">    0.0 </span><span class="si">%22.15e</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s2">&quot;inertia&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span></div>


<div class="viewcode-block" id="Model.append_modes">
<a class="viewcode-back" href="../model.html#model.Model.append_modes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">append_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append a list of modes to the model.</span>

<span class="sd">        :param modes: list of modes which are in the form of tuples: (n,l,freq,inertia).</span>
<span class="sd">        :type modes: list of (int, int, float, float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">))</span></div>


<div class="viewcode-block" id="Model.sort_modes">
<a class="viewcode-back" href="../model.html#model.Model.sort_modes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sort_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort the modes by l, then n, then freq.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># sorts by l, then n, then freq</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model.remove_duplicate_modes">
<a class="viewcode-back" href="../model.html#model.Model.remove_duplicate_modes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_duplicate_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove duplicate modes.</span>

<span class="sd">        Modes are considered to be duplicate if they have the same l</span>
<span class="sd">        and n values (regardless of frequency).</span>

<span class="sd">        :return: ``True`` if at least one mode has been removed.</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. warning::</span>
<span class="sd">          This method assumes the modes are sorted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])):</span>
                <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model.get_age">
<a class="viewcode-back" href="../model.html#model.Model.get_age">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return age of stellar model.</span>

<span class="sd">        This is useful for sorting purposes.</span>

<span class="sd">        :return: the age of the model</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iage</span><span class="p">]</span></div>


<div class="viewcode-block" id="Model.get_freq">
<a class="viewcode-back" href="../model.html#model.Model.get_freq">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_option</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain model frequencies, with optional frequency corrections.</span>

<span class="sd">        :param surface_option: specifies the type of surface correction.  Options include:</span>

<span class="sd">          - ``None``: no corrections are applied</span>
<span class="sd">          - ``&quot;Kjeldsen2008&quot;``: apply a correction based on Kjeldsen et al. (2008)</span>
<span class="sd">          - ``&quot;Kjeldsen2008_scaling&quot;``: apply a correction based on Kjeldsen et al. (2008).</span>
<span class="sd">                                        The exponent is based on a scaling relation from</span>
<span class="sd">                                        Sonoi et al. (2015).</span>
<span class="sd">          - ``&quot;Kjeldsen2008_2&quot;``: apply a correction based on Kjeldsen et al. (2008).</span>
<span class="sd">                                        The exponent is a free parameter.</span>
<span class="sd">          - ``&quot;Ball2014&quot;``:     apply a one-term correction based on Ball and Gizon (2014)</span>
<span class="sd">          - ``&quot;Ball2014_2&quot;``:   apply a two-term correction based on Ball and Gizon (2014)</span>
<span class="sd">          - ``&quot;Sonoi2015&quot;``: apply a correction based on Sonoi et al. (2015)</span>
<span class="sd">          - ``&quot;Sonoi2015_scaling&quot;``: apply a correction based on Sonoi et al. (2015)</span>
<span class="sd">                                        The exponent is based on a scaling relation from</span>
<span class="sd">                                        Sonoi et al. (2015).</span>
<span class="sd">          - ``&quot;Sonoi2015_2&quot;``: apply a correction based on Sonoi et al. (2015)</span>
<span class="sd">                                        The exponent is a free parameter.</span>

<span class="sd">        :param a: amplitude parameters which intervene in the surface correction</span>

<span class="sd">        :type surface_option: string</span>
<span class="sd">        :type a: array-like</span>

<span class="sd">        :return: models frequencies (including surface corrections)</span>
<span class="sd">        :rtype: np.array</span>

<span class="sd">        .. note::</span>
<span class="sd">          If surface_option==None or a==[], the original frequencies are</span>
<span class="sd">          returned (hence modifying them modifies the :py:class:`Model` object).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_surface_correction</span><span class="p">(</span><span class="n">surface_option</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model.get_surface_correction">
<a class="viewcode-back" href="../model.html#model.Model.get_surface_correction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_surface_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_option</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain corrections on model frequencies (these corrections should be</span>
<span class="sd">        *added* to the *theorectical* frequencies).</span>

<span class="sd">        :param surface_option: specifies the type of surface correction.</span>
<span class="sd">          Options include:</span>

<span class="sd">          - ``None``: no corrections are applied</span>
<span class="sd">          - ``&quot;Kjeldsen2008&quot;``: apply a correction based on Kjeldsen et al. (2008)</span>
<span class="sd">          - ``&quot;Kjeldsen2008_scaling&quot;``: apply a correction based on Kjeldsen et al. (2008).</span>
<span class="sd">                                        The exponent is based on a scaling relation from</span>
<span class="sd">                                        Sonoi et al. (2015).</span>
<span class="sd">          - ``&quot;Kjeldsen2008_2&quot;``: apply a correction based on Kjeldsen et al. (2008).</span>
<span class="sd">                                        The exponent is a free parameter.</span>
<span class="sd">          - ``&quot;Ball2014&quot;``:     apply a one-term correction based on Ball and Gizon (2014)</span>
<span class="sd">          - ``&quot;Ball2014_2&quot;``:   apply a two-term correction based on Ball and Gizon (2014)</span>
<span class="sd">          - ``&quot;Sonoi2015&quot;``: apply a correction based on Sonoi et al. (2015)</span>
<span class="sd">          - ``&quot;Sonoi2015_scaling&quot;``: apply a correction based on Sonoi et al. (2015)</span>
<span class="sd">                                        The exponent is based on a scaling relation from</span>
<span class="sd">                                        Sonoi et al. (2015).</span>
<span class="sd">          - ``&quot;Sonoi2015_2&quot;``: apply a correction based on Sonoi et al. (2015)</span>
<span class="sd">                                        The exponent is a free parameter.</span>

<span class="sd">        :param a: parameters which intervene in the surface correction.  According to</span>
<span class="sd">          the correction they take on the following meanings:</span>

<span class="sd">          - ``&quot;Kjeldsen2008&quot;``:         a[0]*freq**b_Kjeldsen2008</span>
<span class="sd">          - ``&quot;Kjeldsen2008_scaling&quot;``: a[0]*freq**b_scaling</span>
<span class="sd">          - ``&quot;Kjeldsen2008_2&quot;``:       a[0]*freq**a[1]</span>
<span class="sd">          - ``&quot;Ball2014&quot;``:             a[0]*freq**3/I</span>
<span class="sd">          - ``&quot;Ball2014_2&quot;``:           a[0]*freq**3/I + a[1]/(freq*I)</span>
<span class="sd">          - ``&quot;Sonoi2015&quot;``:            a[0]*[1 - 1/(1 + (nu/numax)**beta_Sonoi2015)]</span>
<span class="sd">          - ``&quot;Sonoi2015_scaling&quot;``:    a[0]*[1 - 1/(1 + (nu/numax)**beta_scaling)]</span>
<span class="sd">          - ``&quot;Sonoi2015_2&quot;``:          a[0]*[1 - 1/(1 + (nu/numax)**a[1])]</span>

<span class="sd">        :type surface_option: string</span>
<span class="sd">        :type a: array-like</span>

<span class="sd">        :return: surface corrections on the model frequencies</span>
<span class="sd">        :rtype: np.array</span>

<span class="sd">        .. note::</span>
<span class="sd">          The array operations lead to the creation of a new array with the</span>
<span class="sd">          result, which avoids modifications of the original frequencies and inertias.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># easy exit:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ftype</span><span class="p">)</span>

        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">numax</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Kjeldsen2008&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">**</span> <span class="n">config</span><span class="o">.</span><span class="n">b_Kjeldsen2008</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Kjeldsen2008_scaling&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_Kjeldsen2008</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Kjeldsen2008_2&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">**</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Ball2014&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;inertia&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Ball2014_2&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;inertia&#39;</span><span class="p">]</span> \
                <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">freq</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;inertia&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Sonoi2015&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">freq</span> <span class="o">**</span> <span class="n">config</span><span class="o">.</span><span class="n">beta_Sonoi2015</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Sonoi2015_scaling&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">freq</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_Sonoi2015</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">surface_option</span> <span class="o">==</span> <span class="s2">&quot;Sonoi2015_2&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">freq</span> <span class="o">**</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown surface correction: &quot;</span> <span class="o">+</span> <span class="n">surface_option</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">b_Kjeldsen2008</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the exponent for the Kjeldsen et al. (2008) surface correction</span>
<span class="sd">        recipe, as calculated based on the Sonoi et al. (2015) scaling relation.</span>

<span class="sd">        :return: the Kjeldsen et al. exponent</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.16</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">(</span><span class="s2">&quot;log_Teff&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.184</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">(</span><span class="s2">&quot;log_g&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mf">11.7</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">beta_Sonoi2015</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the exponent for the Sonoi et al. (2015) surface correction</span>
<span class="sd">        recipe, as calculated based on the Sonoi et al. (2015) scaling relation.</span>

<span class="sd">        :return: the Kjeldsen et al. exponent</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.86</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">(</span><span class="s2">&quot;log_Teff&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.235</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">(</span><span class="s2">&quot;log_g&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mf">14.2</span><span class="p">)</span>

<div class="viewcode-block" id="Model.multiply_modes">
<a class="viewcode-back" href="../model.html#model.Model.multiply_modes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">multiply_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constant</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiply the frequencies by constant.</span>

<span class="sd">        :param constant: constant by which the mode frequencies are multiplied</span>
<span class="sd">        :type constant: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># NOTE: inertias are non-dimensionless, so they don&#39;t change.</span>
        <span class="c1"># (this has been tested numerically)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">constant</span></div>


<div class="viewcode-block" id="Model.find_mode">
<a class="viewcode-back" href="../model.html#model.Model.find_mode">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ntarget</span><span class="p">,</span> <span class="n">ltarget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a mode with specific n and l values.</span>

<span class="sd">        :param ntarget: target n value</span>
<span class="sd">        :param ltarget: target l value</span>
<span class="sd">        :type ntarget: int</span>
<span class="sd">        :type ltarget: int</span>

<span class="sd">        :return: the frequency of the mode</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">ntarget</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">ltarget</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>


<div class="viewcode-block" id="Model.find_mode_range">
<a class="viewcode-back" href="../model.html#model.Model.find_mode_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_mode_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find n and l ranges of the modes in the model.</span>

<span class="sd">        :return: the n and l ranges of the modes</span>
<span class="sd">        :rtype: int, int, int, int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">nmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
        <span class="n">nmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
        <span class="n">lmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="n">lmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">nmin</span><span class="p">,</span> <span class="n">nmax</span><span class="p">,</span> <span class="n">lmin</span><span class="p">,</span> <span class="n">lmax</span></div>


<div class="viewcode-block" id="Model.find_large_separation">
<a class="viewcode-back" href="../model.html#model.Model.find_large_separation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_large_separation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find large frequency separation using only radial modes.</span>

<span class="sd">        :return: the large frequency separation</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="Model.find_epsilon">
<a class="viewcode-back" href="../model.html#model.Model.find_epsilon">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltarget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find epsilon, the constant offset in a simplified version of Tassoul&#39;s</span>
<span class="sd">        asymptotic formula:</span>

<span class="sd">        :math:`\\nu_n = \\Delta \\nu (n + \\varepsilon)`</span>

<span class="sd">        :param ltarget: target l value.  Only modes with this l value will be</span>
<span class="sd">          used in obtaining epsilon.</span>
<span class="sd">        :type ltarget: int</span>

<span class="sd">        :return: the constant offset</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dnu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_large_separation</span><span class="p">()</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">n</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ltarget</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">one</span> <span class="o">+=</span> <span class="mf">1.0</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">nu</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">one</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">nu</span> <span class="o">/</span> <span class="n">dnu</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">one</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">FeH</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find [Fe/H] value for model.</span>

<span class="sd">        The conversion from (Xs,Zs) to [Fe/H] is performed using the</span>
<span class="sd">        following formula:</span>

<span class="sd">            :math:`\\mathrm{[Fe/H] = \\frac{[M/H]}{A_{FeH}}  \</span>
<span class="sd">                                   = \\frac{1}{A_{FeH}} \\log_{10} \</span>
<span class="sd">                                     \\left(\\frac{z/x}{z_{\\odot}/x_{\\odot}} \\right)}`</span>

<span class="sd">        :return: the :math:`\\mathrm{[Fe/H]}` value</span>
<span class="sd">        :rtype: float</span>

<span class="sd">        .. note::</span>
<span class="sd">          The relevant values are given in :py:mod:`constants`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MH</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">A_FeH</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">log0</span>  <span class="c1"># a rather low value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">FeH0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find initial [Fe/H] value for model.</span>

<span class="sd">        The conversion from (X,Z) to [Fe/H] is performed using the</span>
<span class="sd">        following formula:</span>

<span class="sd">            :math:`\\mathrm{[Fe/H] = \\frac{[M/H]}{A_{FeH}}  \</span>
<span class="sd">                                   = \\frac{1}{A_{FeH}} \\log_{10} \</span>
<span class="sd">                                     \\left(\\frac{z/x}{z_{\\odot}/x_{\\odot}} \\right)}`</span>

<span class="sd">        :return: the initial :math:`\\mathrm{[Fe/H]}` value</span>
<span class="sd">        :rtype: float</span>

<span class="sd">        .. note::</span>
<span class="sd">          The relevant values are given in :py:mod:`constants`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MH0</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">A_FeH</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">log0</span>  <span class="c1"># a rather low value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">MH</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find [M/H] value for model.</span>

<span class="sd">        The conversion from (Xs,Zs) to [M/H] is performed using the</span>
<span class="sd">        following formula:</span>

<span class="sd">            :math:`\\mathrm{[M/H] = \\log_{10} \\left(\\frac{z/x}{z_{\\odot}/x_{\\odot}} \\right)}`</span>

<span class="sd">        :return: the :math:`\\mathrm{[M/H]}` value</span>
<span class="sd">        :rtype: float</span>

<span class="sd">        .. note::</span>
<span class="sd">          The relevant values are given in :py:mod:`constants`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">available_keys</span> <span class="o">=</span> <span class="n">user_params_index</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">have_Zs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">have_Ys</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">have_Xs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">have_ZXs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;Zs&#39;</span> <span class="ow">in</span> <span class="n">available_keys</span><span class="p">:</span>
            <span class="n">Zs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Zs&quot;</span><span class="p">]]</span>
            <span class="n">have_Zs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;Ys&#39;</span> <span class="ow">in</span> <span class="n">available_keys</span><span class="p">:</span>
            <span class="n">Ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Ys&quot;</span><span class="p">]]</span>
            <span class="n">have_Ys</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;Xs&#39;</span> <span class="ow">in</span> <span class="n">available_keys</span><span class="p">:</span>
            <span class="n">Xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Xs&quot;</span><span class="p">]]</span>
            <span class="n">have_Xs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;ZXs&#39;</span> <span class="ow">in</span> <span class="n">available_keys</span><span class="p">:</span>
            <span class="n">ZXs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;ZXs&quot;</span><span class="p">]]</span>
            <span class="n">have_ZXs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;ZHsurf&#39;</span> <span class="ow">in</span> <span class="n">available_keys</span><span class="p">:</span>
            <span class="n">ZXs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;ZHsurf&quot;</span><span class="p">]]</span>
            <span class="n">have_ZXs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">have_Zs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">have_Xs</span> <span class="ow">and</span> <span class="n">have_Ys</span><span class="p">:</span>
                <span class="n">Zs</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Xs&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Ys&quot;</span><span class="p">]]</span>
                <span class="n">have_Zs</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">have_ZXs</span> <span class="ow">and</span> <span class="n">have_Xs</span><span class="p">:</span>
                <span class="n">Zs</span> <span class="o">=</span> <span class="n">ZXs</span> <span class="o">*</span> <span class="n">Xs</span>
                <span class="n">have_Zs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Zs</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_x</span> <span class="o">/</span> <span class="p">(</span><span class="n">Xs</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_z</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">log0</span>  <span class="c1"># a rather low value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">MH0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find initial [M/H] value for model.</span>

<span class="sd">        The conversion from (X,Z) to [M/H] is performed using the</span>
<span class="sd">        following formula:</span>

<span class="sd">            :math:`\\mathrm{[M/H] = \\log_{10} \\left(\\frac{z/x}{z_{\\odot}/x_{\\odot}} \\right)}`</span>

<span class="sd">        :return: the initial :math:`\\mathrm{[M/H]}` value</span>
<span class="sd">        :rtype: float</span>

<span class="sd">        .. note::</span>
<span class="sd">          The relevant values are given in :py:mod:`constants`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iz0</span><span class="p">]</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_x</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ix0</span><span class="p">]</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_z</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">log0</span>  <span class="c1"># a rather low value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">zsx_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the Zs/Xs value</span>

<span class="sd">        :return: the Zs/Xs value</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Zs&quot;</span><span class="p">]]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Xs&quot;</span><span class="p">]]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">zsx_0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the Z0/X0 value</span>

<span class="sd">        :return: the Z0/X0 value</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iz0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ix0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">numax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find :math:`\\nu_{\\mathrm{max}}` for model.</span>

<span class="sd">        The :math:`\\nu_{\\mathrm{max}}` value is obtained from the</span>
<span class="sd">        following scaling relation:</span>

<span class="sd">            :math:`\\frac{\\nu_{\\mathrm{max}}}{\\nu_{\\mathrm{max},\\odot}} \</span>
<span class="sd">                      = \\left(\\frac{M}{M_{\\odot}}\\right)                \</span>
<span class="sd">                        \\left(\\frac{R}{R_{\\odot}}\\right)^{-2}           \</span>
<span class="sd">                        \\left(\\frac{T_{\\mathrm{eff}}}{T_{\\mathrm{eff},\\odot}}\\right)^{-1/2}`</span>

<span class="sd">        :return: the :math:`\\nu_{\\mathrm{max}}` value</span>
<span class="sd">        :rtype: float</span>

<span class="sd">        .. note::</span>
<span class="sd">          The relevant values are given in :py:mod:`constants`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_numax</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_mass</span><span class="p">)</span> \
            <span class="o">/</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_radius</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
               <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">itemperature</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_temperature</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find :math:`\\nu_{\\mathrm{cut-off}}` for model.</span>

<span class="sd">        The :math:`\\nu_{\\mathrm{cut-off}}` value is obtained from the</span>
<span class="sd">        following scaling relation:</span>

<span class="sd">            :math:`\\frac{\\nu_{\\mathrm{cut-off}}}{\\nu_{\\mathrm{cut-off},\\odot}} \</span>
<span class="sd">                      = \\left(\\frac{M}{M_{\\odot}}\\right)                        \</span>
<span class="sd">                        \\left(\\frac{R}{R_{\\odot}}\\right)^2                      \</span>
<span class="sd">                        \\left(\\frac{T_{\\mathrm{eff}}}{T_{\\mathrm{eff},\\odot}}\\right)^{-1/2}`</span>

<span class="sd">        :return: the :math:`\\nu_{\\mathrm{cut-off}}` value</span>
<span class="sd">        :rtype: float</span>

<span class="sd">        .. note::</span>
<span class="sd">          The relevant values are given in :py:mod:`constants`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_cutoff</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_mass</span><span class="p">)</span> \
            <span class="o">/</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_radius</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> \
               <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">itemperature</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_temperature</span><span class="p">))</span>

<div class="viewcode-block" id="Model.freq_sorted">
<a class="viewcode-back" href="../model.html#model.Model.freq_sorted">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">freq_sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check to see if the frequencies are in ascending order for each l value.</span>

<span class="sd">        :return: ``True`` if the frequencies are in ascending order.</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># if (self.modes[&#39;l&#39;][i] &gt; 0): continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Model.print_me">
<a class="viewcode-back" href="../model.html#model.Model.print_me">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Print classical and seismic characteristics of the model to standard output.&quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----- Model: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; -----&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mass (in M_sun):              </span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_mass</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Radius (in R_sun):            </span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_radius</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reference frequency (in uHz): </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Temperature (in K):           </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">itemperature</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Luminosity (in L_sun):        </span><span class="si">%.3g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iluminosity</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_luminosity</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Age (in Myrs):                </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iage</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Age parameter:                </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iage_adim</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Z:                            </span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iz0</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X:                            </span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ix0</span><span class="p">])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">latex_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:29}</span><span class="s2"> </span><span class="si">{1:.5e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="n">name</span><span class="p">]]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modes (in muHz):&quot;</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  (n,l,freq,IK) = (</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">, </span><span class="si">%.15f</span><span class="s2">, </span><span class="si">%.5e</span><span class="s2">)&quot;</span> <span class="o">%</span> \
                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">],</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;inertia&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span></div>
</div>



<div class="viewcode-block" id="Track">
<a class="viewcode-back" href="../model.html#model.Track">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Track</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An evolutionary track.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aModel</span><span class="p">,</span> <span class="n">grid_params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param aModel: first model to be added to evolutionary track (it does</span>
<span class="sd">          not need to be the youngest model in an evolutionary sequence).  This</span>
<span class="sd">          Model is used to obtain the relevant parameters for the evolutionary</span>
<span class="sd">          track (as given by the :py:data:`grid_params` variable).</span>

<span class="sd">        :param grid_params: list of strings which are the names of the</span>
<span class="sd">          parameters which describe the evolutionary track.</span>

<span class="sd">        :type aModel: :py:class:`Model`</span>
<span class="sd">        :type grid_params: list of strings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span> <span class="o">=</span> <span class="n">grid_params</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Names of the parameters used to construct the grid&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">utilities</span><span class="o">.</span><span class="n">my_map</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">))</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parameters which characterise this evolutionary track&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nmodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Total number pulsation modes from all of the models in this evolutionary track&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">aModel</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; List of model names &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">glb</span> <span class="o">=</span> <span class="n">aModel</span><span class="o">.</span><span class="n">glb</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">nglb</span><span class="p">))</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Global properties of the models &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">aModel</span><span class="o">.</span><span class="n">modes</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; array containing the modes (n, l, freq, inertia) of all of the models &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">modes</span><span class="p">)]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; starting indices in :py:data:`Track.modes` array corresponding to a given model &quot;&quot;&quot;</span>

        <span class="k">del</span> <span class="n">aModel</span>  <span class="c1"># clean up to avoid using too much memory</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a track and clear the arrays it contained.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmodes</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span>

<div class="viewcode-block" id="Track.append">
<a class="viewcode-back" href="../model.html#model.Track.append">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aModel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append a model to the evolutionary track.</span>

<span class="sd">        :param aModel: model which is being appended to the track</span>
<span class="sd">        :type aModel: :py:class:`Model`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nmodes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">,</span> <span class="n">aModel</span><span class="o">.</span><span class="n">glb</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">nglb</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">,</span> <span class="n">aModel</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmodes</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">aModel</span>  <span class="c1"># clean up to avoid using too much memory</span></div>


<div class="viewcode-block" id="Track.append_track">
<a class="viewcode-back" href="../model.html#model.Track.append_track">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">append_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aTrack</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append a track to the current evolutionary track (i.e. combine the two tracks),</span>
<span class="sd">        and remove the track which has been appended.  The resultant track is then</span>
<span class="sd">        sorted according to age.</span>

<span class="sd">        :param aModel: model which is being appended to the track</span>
<span class="sd">        :type aModel: :py:class:`Model`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">+=</span> <span class="n">aTrack</span><span class="o">.</span><span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">,</span> <span class="n">aTrack</span><span class="o">.</span><span class="n">glb</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">,</span> <span class="n">aTrack</span><span class="o">.</span><span class="n">modes</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nmodes</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aTrack</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nmodes</span> <span class="o">+=</span> <span class="n">aTrack</span><span class="o">.</span><span class="n">nmodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span></div>


<div class="viewcode-block" id="Track.matches">
<a class="viewcode-back" href="../model.html#model.Track.matches">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aModel</span><span class="p">,</span> <span class="n">params_tol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check to see if a model matches the evolutionary track and can therefore</span>
<span class="sd">        be included in the track.</span>

<span class="sd">        :param aModel: input model being tested</span>
<span class="sd">        :type aModel: :py:class:`Model`</span>

<span class="sd">        :param params_tol: the tolerance on each parameter. ``None`` means no</span>
<span class="sd">                 tolerance (i.e. the parameters have to be exactly the same).</span>
<span class="sd">        :type params_tol: float np.array</span>

<span class="sd">        :return: ``True`` only if all of the parameters of the input model match</span>
<span class="sd">                 those of the evolutionary track within the provided tolerances</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params_bis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">utilities</span><span class="o">.</span><span class="n">my_map</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">params_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">==</span> <span class="n">params_bis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">-</span> <span class="n">params_bis</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">params_tol</span><span class="p">)</span></div>


<div class="viewcode-block" id="Track.sort">
<a class="viewcode-back" href="../model.html#model.Track.sort">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sort models within evolutionary track according to age.&quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage</span><span class="p">])</span>

        <span class="c1"># sort model names</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">my_map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">temp</span>

        <span class="c1"># sort global parameters</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glb</span> <span class="o">=</span> <span class="n">temp</span>

        <span class="c1"># sort modes and mode indices:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">modetype</span><span class="p">)</span>
        <span class="n">ntot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="p">[</span><span class="n">ntot</span><span class="p">,</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">nmodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">ntot</span><span class="p">:</span><span class="n">ntot</span> <span class="o">+</span> <span class="n">nmodes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
            <span class="n">ntot</span> <span class="o">+=</span> <span class="n">nmodes</span>
            <span class="n">temp2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ntot</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span> <span class="o">=</span> <span class="n">temp2</span></div>


<div class="viewcode-block" id="Track.is_sorted">
<a class="viewcode-back" href="../model.html#model.Track.is_sorted">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check to see of models are in ascending order according to age.</span>

<span class="sd">        :return: ``True`` if the models ar in order of increasing age</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="Track.is_sorted_adim">
<a class="viewcode-back" href="../model.html#model.Track.is_sorted_adim">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_sorted_adim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check to see of models are in ascending order according to age.</span>

<span class="sd">        :return: ``True`` if the models ar in order of increasing age</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">iage_adim</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iage_adim</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="Track.freq_sorted">
<a class="viewcode-back" href="../model.html#model.Track.freq_sorted">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">freq_sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imodel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check to see if the frequencies of model i are in ascending order</span>
<span class="sd">        for each l value.</span>

<span class="sd">        :param imodel: the number of the model to be checked</span>
<span class="sd">        :type imodel: int</span>

<span class="sd">        :return: ``True`` if the frequencies are in ascending order.</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">imodel</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">imodel</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># if (self.modes[&#39;l&#39;][i] &gt; 0): continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Track.find_epsilon">
<a class="viewcode-back" href="../model.html#model.Track.find_epsilon">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imodel</span><span class="p">,</span> <span class="n">ltarget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find epsilon, the constant offset in a simplified version of Tassoul&#39;s</span>
<span class="sd">        asymptotic formula:</span>

<span class="sd">        :math:`\\nu_n = \\Delta \\nu (n + \\varepsilon)`</span>

<span class="sd">        :param imodel: model number</span>
<span class="sd">        :type imodel: ltarget</span>

<span class="sd">        :param ltarget: target l value.  Only modes with this l value will be</span>
<span class="sd">          used in obtaining epsilon.</span>
<span class="sd">        :type ltarget: int</span>

<span class="sd">        :return: the constant offset</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dnu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_large_separation</span><span class="p">(</span><span class="n">imodel</span><span class="p">)</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">n</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">imodel</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">imodel</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ltarget</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">one</span> <span class="o">+=</span> <span class="mf">1.0</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">nu</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">one</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">nu</span> <span class="o">/</span> <span class="n">dnu</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">one</span></div>


<div class="viewcode-block" id="Track.find_large_separation">
<a class="viewcode-back" href="../model.html#model.Track.find_large_separation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_large_separation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imodel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find large frequency separation using only radial modes.</span>

<span class="sd">        :param imodel: model number</span>
<span class="sd">        :type imodel: ltarget</span>

<span class="sd">        :return: the large frequency separation</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">istart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">imodel</span><span class="p">]</span>
        <span class="n">istop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">imodel</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">istart</span><span class="p">:</span><span class="n">istop</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">istart</span><span class="p">:</span><span class="n">istop</span><span class="p">]</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">istart</span><span class="p">:</span><span class="n">istop</span><span class="p">]</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="Track.duplicate_ages">
<a class="viewcode-back" href="../model.html#model.Track.duplicate_ages">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">duplicate_ages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check to see if the evolutionary track contains models with duplicate ages.</span>

<span class="sd">        :return: ``True`` if there are duplicate age(s)</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This method should only be applied after the track has been</span>
<span class="sd">            sorted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="Track.remove_duplicate_ages">
<a class="viewcode-back" href="../model.html#model.Track.remove_duplicate_ages">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_duplicate_ages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes models with duplicate ages from the evolutionary track.</span>

<span class="sd">        :return: ``True`` if models with duplicate age(s) have been removed</span>
<span class="sd">        :rtype: boolean</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This method should only be applied after the track has been</span>
<span class="sd">            sorted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># produce list of models to be removed:</span>
        <span class="n">remove_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">))</span> \
                         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">iage</span><span class="p">]]</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">remove_models</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># remove duplicate models:</span>
            <span class="n">mode_indices_rm</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">remove_models</span><span class="p">:</span>
                <span class="n">mode_indices_rm</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">remove_models</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">,</span> <span class="n">remove_models</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">,</span> <span class="n">mode_indices_rm</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">ntot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">new_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ntot</span><span class="p">]</span>
            <span class="c1"># NOTE: the first model is kept (by construction)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_models</span><span class="p">):</span>
                    <span class="n">ntot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">new_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ntot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span> <span class="o">=</span> <span class="n">new_indices</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ntot</span>

            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Track.age_adim_to_age">
<a class="viewcode-back" href="../model.html#model.Track.age_adim_to_age">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">age_adim_to_age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace dimensionless age parameter by the physical age.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This method should only be applied after the track has been</span>
<span class="sd">            sorted (according to age).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage_adim</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage</span><span class="p">]</span></div>


<div class="viewcode-block" id="Track.age_adim_to_scale_age">
<a class="viewcode-back" href="../model.html#model.Track.age_adim_to_scale_age">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">age_adim_to_scale_age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace dimensionless age parameter by the physical age scaled from 0 to 1.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This method should only be applied after the track has been</span>
<span class="sd">            sorted (according to age).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">age_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span>
        <span class="n">age_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage_adim</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">-</span> <span class="n">age_start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">age_stop</span> <span class="o">-</span> <span class="n">age_start</span><span class="p">)</span></div>


<div class="viewcode-block" id="Track.age_adim_to_scale_Xc">
<a class="viewcode-back" href="../model.html#model.Track.age_adim_to_scale_Xc">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">age_adim_to_scale_Xc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace dimensionless age parameter by the central hydrogen abundance, Xc,</span>
<span class="sd">        scaled from 0 to 1.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This method should only be applied after the track has been</span>
<span class="sd">            sorted (according to age).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Raises a key error if Xc isn&#39;t in the grid,</span>
        <span class="c1"># which should be informative enough</span>
        <span class="n">ixc</span> <span class="o">=</span> <span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Xc&quot;</span><span class="p">]</span>

        <span class="n">Xc_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ixc</span><span class="p">]</span>
        <span class="n">Xc_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ixc</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage_adim</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">ixc</span><span class="p">]</span> <span class="o">-</span> <span class="n">Xc_start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Xc_stop</span> <span class="o">-</span> <span class="n">Xc_start</span><span class="p">)</span></div>


<div class="viewcode-block" id="Track.interpolate_model">
<a class="viewcode-back" href="../model.html#model.Track.interpolate_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">interpolate_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a model at a given age which is obtained using linear interpolation.</span>

<span class="sd">        :param age: age of desired model in :math:`\\mathrm{Myrs}`</span>
<span class="sd">        :type age: float</span>

<span class="sd">        :return: the interpolated model</span>
<span class="sd">        :rtype: :py:class:`Model`</span>

<span class="sd">        .. warning::</span>
<span class="sd">          This method assumes the track is sorted, since it applies</span>
<span class="sd">          a binary search algorithm for increased efficiency.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># easy exit:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">age</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">iage</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">age</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">istart</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">istop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">istop</span> <span class="o">&gt;</span> <span class="n">istart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">itemp</span> <span class="o">=</span> <span class="p">(</span><span class="n">istop</span> <span class="o">+</span> <span class="n">istart</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">age</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">itemp</span><span class="p">,</span> <span class="n">iage</span><span class="p">]):</span>
                <span class="n">istop</span> <span class="o">=</span> <span class="n">itemp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">istart</span> <span class="o">=</span> <span class="n">itemp</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">age</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">istart</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span> \
             <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">istop</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">istart</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">combine_models</span><span class="p">(</span>
            <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">istart</span><span class="p">],</span> <span class="n">_modes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">istart</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">istart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]),</span>
            <span class="mf">1.0</span> <span class="o">-</span> <span class="n">mu</span><span class="p">,</span> \
            <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">istop</span><span class="p">],</span> <span class="n">_modes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">istop</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">istop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]),</span> <span class="n">mu</span><span class="p">)</span></div>


<div class="viewcode-block" id="Track.find_combination">
<a class="viewcode-back" href="../model.html#model.Track.find_combination">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_combination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">coef</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a model combination at a given age which is obtained using linear interpolation.</span>

<span class="sd">        :param age: age of desired model in :math:`\\mathrm{Myrs}`</span>
<span class="sd">        :param coef: coefficient which multiplies this combination</span>

<span class="sd">        :type age: float</span>
<span class="sd">        :type coef: float</span>

<span class="sd">        :return: pairs composed of an interpolation coefficient and a model name</span>
<span class="sd">        :rtype: tuple of (float, string)</span>

<span class="sd">        .. warning::</span>
<span class="sd">          This method assumes the track is sorted, since it applies</span>
<span class="sd">          a binary search algorithm for increased efficiency.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># easy exit:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">age</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">iage</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">age</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">istart</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">istop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">istop</span> <span class="o">&gt;</span> <span class="n">istart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">itemp</span> <span class="o">=</span> <span class="p">(</span><span class="n">istop</span> <span class="o">+</span> <span class="n">istart</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">age</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">itemp</span><span class="p">,</span> <span class="n">iage</span><span class="p">]):</span>
                <span class="n">istop</span> <span class="o">=</span> <span class="n">itemp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">istart</span> <span class="o">=</span> <span class="n">itemp</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">age</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">istart</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span> \
             <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">istop</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">istart</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">coef</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">mu</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">istart</span><span class="p">]),</span> <span class="p">(</span><span class="n">coef</span> <span class="o">*</span> <span class="n">mu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">istop</span><span class="p">]))</span></div>


<div class="viewcode-block" id="Track.find_modes">
<a class="viewcode-back" href="../model.html#model.Track.find_modes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ntarget</span><span class="p">,</span> <span class="n">ltarget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return two lists, one with the ages of the models and the other</span>
<span class="sd">        with the mode non-dimensional frequencies corresponding to target n and l values.</span>

<span class="sd">        This function is useful for seeing how the frequency of a particular</span>
<span class="sd">        mode changes with stellar age.</span>

<span class="sd">        :param ntarget: target n value</span>
<span class="sd">        :param ltarget: target l value</span>

<span class="sd">        :type ntarget: int</span>
<span class="sd">        :type ltarget: int</span>

<span class="sd">        :return: lists of ages and frequencies</span>
<span class="sd">        :rtype: list, list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage</span><span class="p">])</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">ntarget</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">ltarget</span><span class="p">)):</span>
                    <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ages</span><span class="p">,</span> <span class="n">freqs</span></div>


<div class="viewcode-block" id="Track.find_modes_dim">
<a class="viewcode-back" href="../model.html#model.Track.find_modes_dim">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_modes_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ntarget</span><span class="p">,</span> <span class="n">ltarget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return two lists, one with the ages of the models and the other</span>
<span class="sd">        with the mode dimensional frequencies corresponding to target n and l values.</span>

<span class="sd">        This function is useful for seeing how the frequency of a particular</span>
<span class="sd">        mode changes with stellar age.</span>

<span class="sd">        :param ntarget: target n value</span>
<span class="sd">        :param ltarget: target l value</span>

<span class="sd">        :type ntarget: int</span>
<span class="sd">        :type ltarget: int</span>

<span class="sd">        :return: lists of ages and frequencies</span>
<span class="sd">        :rtype: list, list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage</span><span class="p">])</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">ntarget</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">ltarget</span><span class="p">)):</span>
                    <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ifreq_ref</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ages</span><span class="p">,</span> <span class="n">freqs</span></div>


<div class="viewcode-block" id="Track.find_mode_range">
<a class="viewcode-back" href="../model.html#model.Track.find_mode_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_mode_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find n and l ranges of modes in models</span>

<span class="sd">        :return: the n and l ranges</span>
<span class="sd">        :rtype: int, int, int, int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]),</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">age_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the age range for an evolutionary track.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">age_lower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the lowest age an evolutionary track.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">iage</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">age_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the highest age for an evolutionary track.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">iage</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span>

<div class="viewcode-block" id="Track.test_interpolation">
<a class="viewcode-back" href="../model.html#model.Track.test_interpolation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nincr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test accuracy of interpolation along evolutionary track.</span>

<span class="sd">        This method removes every other model and retrieves its frequencies</span>
<span class="sd">        by interpolation from neighbouring models.  The accuracy of the</span>
<span class="sd">        interpolated frequencies and global parameters are tested by carrying</span>
<span class="sd">        out comparisons with the original models.</span>

<span class="sd">        :param nincr: increment with which to carry out the interpolation.</span>
<span class="sd">          By comparing results for different values of ``nincr``, one can</span>
<span class="sd">          evaluate how the interpolation error depends on the size of the</span>
<span class="sd">          interval over which the interpolation is carried out.</span>
<span class="sd">        :type nincr: int</span>

<span class="sd">        :return: the interpolation errors</span>
<span class="sd">        :rtype: np.array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialisation</span>
        <span class="n">nmodels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nmodels</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nincr</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">+</span> <span class="n">nglb</span> <span class="o">+</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>

        <span class="c1"># loop through all models:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nincr</span><span class="p">,</span> <span class="n">nmodels</span> <span class="o">-</span> <span class="n">nincr</span><span class="p">):</span>
            <span class="c1"># carry out interpolation</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">nincr</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span> \
                 <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">nincr</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">nincr</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span>
            <span class="n">aModel</span> <span class="o">=</span> <span class="n">combine_models</span><span class="p">(</span><span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">nincr</span><span class="p">],</span> <span class="n">_modes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">nincr</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span>
                                                                          <span class="n">i</span> <span class="o">-</span> <span class="n">nincr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]),</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">mu</span><span class="p">,</span> \
                                    <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">nincr</span><span class="p">],</span> <span class="n">_modes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">nincr</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span>
                                                                          <span class="n">i</span> <span class="o">+</span> <span class="n">nincr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]),</span> <span class="n">mu</span><span class="p">)</span>

            <span class="n">result</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">nincr</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
            <span class="n">result</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">nincr</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">nincr</span><span class="p">,</span> <span class="n">ndim</span><span class="p">:</span><span class="n">ndim</span> <span class="o">+</span> <span class="n">nglb</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">compare_models</span><span class="p">(</span><span class="n">aModel</span><span class="p">,</span> <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_modes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span>
                                                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span>
                                                                                                           <span class="n">i</span><span class="p">]:</span>
                                                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span>
                                                                                                           <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]))</span>

        <span class="k">return</span> <span class="n">result</span></div>
</div>



<div class="viewcode-block" id="Model_grid">
<a class="viewcode-back" href="../model.html#model.Model_grid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Model_grid</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A grid of models.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of dimensions for the grid (excluding age), as based on the</span>
<span class="sd">        :py:data:`Model_grid.grid_params` variable</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of evolutionary tracks contained in the grid.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ndx</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List containing track indices&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Array containing the grid parameters for each evolutionary track (excluding age).&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Object containing the tessellation of the grid used for interpolation.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set of parameters (excluding age) used to construct the grid and do interpolations.</span>

<span class="sd">        .. note::        </span>
<span class="sd">          For best interpolation results, these parameters should be comparable.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Root folder with grid of models (including final slash).&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;.freq&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Last part of the filenames which contain the model frequencies (default = &quot;.freq&quot;).&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">user_params</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">user_params</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The set of user parameters involved in the grid.  This is to avoid having a different</span>
<span class="sd">        set of user parameters in `AIMS_configure.py`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">distort_mat</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transformation matrix used to break the Cartesian character of the grid and reduce</span>
<span class="sd">        computation time</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Model_grid.read_model_list">
<a class="viewcode-back" href="../model.html#model.Model_grid.read_model_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_model_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read list of models from a file and construct a grid.  If</span>
<span class="sd">        the mode format is Aldo, an entirely different strategy</span>
<span class="sd">        must be used.</span>

<span class="sd">        :param filename: name of the file with the list.</span>
<span class="sd">        :type filename: string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">mode_format</span> <span class="o">==</span> <span class="s2">&quot;Aldo&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_model_list_Aldo</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_model_list_standard</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model_grid.read_model_list_standard">
<a class="viewcode-back" href="../model.html#model.Model_grid.read_model_list_standard">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_model_list_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read list of models from a file and construct a grid.</span>

<span class="sd">        :param filename: name of the file with the list.  The first line</span>
<span class="sd">          of this file should contain a prefix which is typically the root</span>
<span class="sd">          folder of the grid of models.  This followed by a file with multiple</span>
<span class="sd">          columns.  The first 9 contain the following information for each model:</span>

<span class="sd">          1. the second part of the path.  When concatenated with the prefix</span>
<span class="sd">             on the first line, this should give the full path to the model.</span>
<span class="sd">          2. The stellar mass in :math:`\\mathrm{g}`</span>
<span class="sd">          3. The stellar radius in :math:`\\mathrm{cm}`</span>
<span class="sd">          4. The stellar luminosity in :math:`\\mathrm{g.cm^2.s^{-3}}`</span>
<span class="sd">          5. The metallicity</span>
<span class="sd">          6. The hydrogen content</span>
<span class="sd">          7. The stellar age in :math:`\\mathrm{Myrs}`</span>
<span class="sd">          8. The effective temperature in :math:`\\mathrm{K}`</span>
<span class="sd">          9. A dimensionless age parameter</span>

<span class="sd">          The following columns contain the parameters specified in the</span>
<span class="sd">          :py:data:`AIMS_configure.user_params` variable.</span>

<span class="sd">        :type filename: string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">grid_params</span>

        <span class="c1"># set the correct dimension:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">)</span>

        <span class="c1"># set prefix and postfix:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">listfile</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">listfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Erroneous first line in </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">postfix</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postfix</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># read list with numpy:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading list file&quot;</span><span class="p">)</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="p">[</span><span class="n">imass</span><span class="p">,</span> <span class="n">iradius</span><span class="p">,</span> <span class="n">iluminosity</span><span class="p">,</span> <span class="n">iz0</span><span class="p">,</span> <span class="n">ix0</span><span class="p">,</span> <span class="n">iage</span><span class="p">,</span> <span class="n">itemperature</span><span class="p">,</span> <span class="n">iage_adim</span><span class="p">]</span> \
               <span class="o">+</span> <span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="n">name_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">name_pair</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">]</span>
        <span class="n">invperm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">perm</span><span class="p">)):</span>
            <span class="n">invperm</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">glb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">invperm</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">filename_dtype</span><span class="p">)</span>

        <span class="c1"># sort list: this separates the evolutionary tracks (which still need</span>
        <span class="c1">#            to be partitionned)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sorting models&quot;</span><span class="p">)</span>
        <span class="n">grid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">age_str</span><span class="p">,</span> <span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">)</span>
        <span class="n">grid_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">utilities</span><span class="o">.</span><span class="n">my_map</span><span class="p">(</span><span class="n">Model</span><span class="p">(</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">string_to_param</span><span class="p">,</span> \
                                               <span class="n">grid_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">([</span><span class="n">grid_temp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
        <span class="n">params_span</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">grid_temp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">grid_temp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> \
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">grid_temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
        <span class="k">del</span> <span class="n">grid_temp</span>

        <span class="c1"># sanity check:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">)):</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">params_span</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">span</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The values of some models parameters are NaN.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">span</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The values of some models parameters are infinite.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">span</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ERROR: parameter </span><span class="si">%s</span><span class="s2"> is constant in your grid&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span>
                                 <span class="s2">&quot;and cannot be used as a grid parameter.&quot;</span><span class="p">)</span>

        <span class="c1"># create tracks:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating evolutionary tracks&quot;</span><span class="p">)</span>
        <span class="n">nmodes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">models_small_spectra</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nmodels</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="n">nmodels</span><span class="p">]</span>
            <span class="n">aModel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_name</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="n">aModel</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">postfix</span><span class="p">)</span>
            <span class="n">aModel</span><span class="o">.</span><span class="n">multiply_modes</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">aModel</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">])</span>  <span class="c1"># make frequencies non-dimensional</span>
            <span class="n">aModel</span><span class="o">.</span><span class="n">sort_modes</span><span class="p">()</span>
            <span class="n">aModel</span><span class="o">.</span><span class="n">remove_duplicate_modes</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">aModel</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aModel</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aTrack</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="n">aModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aTrack</span><span class="p">)</span>
            <span class="n">nmodes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">exceed_freqlim</span><span class="p">):</span>
                <span class="n">models_small_spectra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">batch</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="n">nmodels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmodes</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[2A&#39;</span><span class="p">)</span>  <span class="c1"># backup two line - might not work in all terminals</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="n">glb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nmodes</span><span class="p">))</span>
        <span class="k">del</span> <span class="n">glb</span>
        <span class="k">del</span> <span class="n">names</span>
        <span class="k">del</span> <span class="n">ind</span>

        <span class="c1"># merge tracks which are too close:</span>
        <span class="n">imerge</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">params_span</span> <span class="o">*=</span> <span class="n">eps</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">)):</span>
            <span class="n">aModel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">aModel</span><span class="p">,</span> <span class="n">params_tol</span><span class="o">=</span><span class="n">params_span</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append_track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">imerge</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I merged </span><span class="si">%d</span><span class="s2"> track(s)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imerge</span><span class="p">))</span>

        <span class="c1"># write list of models with spectra which are too small in a file:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;models_small_spectra&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">models_small_spectra</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># sort tracks:</span>
        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
            <span class="n">track</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># remove duplicate models:</span>
        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">track</span><span class="o">.</span><span class="n">remove_duplicate_ages</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: the track </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">grid_params</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">params</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;         has models with the same age.  Removing duplicate models.&quot;</span><span class="p">)</span>

        <span class="c1"># update list of indices:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">))</span>

        <span class="c1"># need to create grid from scratch since tracks have been sorted.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">track</span><span class="o">.</span><span class="n">params</span> <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">])</span></div>


<div class="viewcode-block" id="Model_grid.read_model_list_Aldo">
<a class="viewcode-back" href="../model.html#model.Model_grid.read_model_list_Aldo">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_model_list_Aldo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read list of models in Aldo format from a file and construct a grid.</span>

<span class="sd">        A track in Aldo format contains 3 parts:</span>

<span class="sd">          1. A three line header which is discarded.</span>
<span class="sd">          2. A set of four lines, for l=0 to 3, which describe the mode structure.  The</span>
<span class="sd">             first columns gives the start value of n, whereas the second column gives</span>
<span class="sd">             the number of modes for that particular l value.</span>
<span class="sd">          3. A table where each line corresponds to a model and the different columns</span>
<span class="sd">             correspond to the model ID, global quantities, and pulsation frequencies</span>
<span class="sd">             and inertias.</span>

<span class="sd">        :param filename: name of the file with the list of track files.</span>
<span class="sd">        :type filename: string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># sanity check:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;user_params should have length 5 for Aldo format but got </span><span class="si">%i</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Xc&#39;</span><span class="p">,</span> <span class="s1">&#39;Zc&#39;</span><span class="p">,</span> <span class="s1">&#39;Xs&#39;</span><span class="p">,</span> <span class="s1">&#39;Zs&#39;</span><span class="p">,</span> <span class="s1">&#39;Mass_true&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">user_params_index</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> missing from user_params variable but needed for Aldo format.&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">grid_params</span>

        <span class="c1"># set the correct dimension:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">)</span>

        <span class="c1"># set prefix and postfix:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">listfile</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">listfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Erroneous first line in </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="c1"># read models and put them into evolutionary tracks:</span>
            <span class="n">nmodels</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">nmodes</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">models_small_spectra</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">norder</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ntype</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">listfile</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># read track file:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">z0</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">Mass0</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">trackfile</span><span class="p">:</span>
                    <span class="c1"># skip header:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">trackfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="c1"># read mode structure</span>
                    <span class="n">ntot</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                        <span class="n">columns</span> <span class="o">=</span> <span class="n">trackfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">norder</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">norder</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">ntot</span> <span class="o">+=</span> <span class="n">norder</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="c1"># read models with numpy:</span>
                <span class="n">glbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ntot</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">filename_dtype</span><span class="p">)</span>

                <span class="c1"># read models</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">glbs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">x0</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">z0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">z0</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">Mass0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">Mass0</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_mass</span>
                    <span class="n">glb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nglb</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mass0</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_radius</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">iluminosity</span><span class="p">]</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_luminosity</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">iz0</span><span class="p">]</span> <span class="o">=</span> <span class="n">z0</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">ix0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">iage</span><span class="p">]</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">itemperature</span><span class="p">]</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">iage_adim</span><span class="p">]</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># may be replace later on</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Mass_true&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Xs&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Zs&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Xc&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
                    <span class="n">glb</span><span class="p">[</span><span class="n">user_params_index</span><span class="p">[</span><span class="s2">&quot;Zc&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">-</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>

                    <span class="n">aModel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">glb</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">exceed_freqlim</span> <span class="o">=</span> <span class="n">aModel</span><span class="o">.</span><span class="n">read_modes_Aldo</span><span class="p">(</span><span class="n">norder</span><span class="p">,</span> <span class="n">glbs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">:])</span>
                    <span class="n">aModel</span><span class="o">.</span><span class="n">multiply_modes</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">aModel</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">])</span>  <span class="c1"># make frequencies non-dimensional</span>
                    <span class="n">aModel</span><span class="o">.</span><span class="n">sort_modes</span><span class="p">()</span>
                    <span class="c1"># We&#39;re assuming the models are grouped together in tracks, so</span>
                    <span class="c1"># we only need to check the previous track:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">aModel</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aModel</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">aTrack</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="n">aModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aTrack</span><span class="p">)</span>
                    <span class="n">nmodels</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">nmodes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">exceed_freqlim</span><span class="p">:</span>
                        <span class="n">models_small_spectra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aModel</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">batch</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="n">nmodels</span><span class="p">,</span> <span class="n">nmodes</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[2A&#39;</span><span class="p">)</span>  <span class="c1"># backup two line - might not work in all terminals</span>

                <span class="k">del</span> <span class="n">glbs</span>
                <span class="k">del</span> <span class="n">names</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="n">nmodels</span><span class="p">,</span> <span class="n">nmodes</span><span class="p">))</span>

        <span class="c1"># find span for each grid parameter prior to merging tracks:</span>
        <span class="n">grid_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">track</span><span class="o">.</span><span class="n">params</span> <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">])</span>
        <span class="n">params_span</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">grid_temp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">grid_temp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> \
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">grid_temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
        <span class="k">del</span> <span class="n">grid_temp</span>

        <span class="c1"># merge tracks which are too close:</span>
        <span class="n">imerge</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">params_span</span> <span class="o">*=</span> <span class="n">eps</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">)):</span>
            <span class="n">aModel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">aModel</span><span class="p">,</span> <span class="n">params_tol</span><span class="o">=</span><span class="n">params_span</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append_track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">imerge</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I merged </span><span class="si">%d</span><span class="s2"> track(s)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">imerge</span><span class="p">))</span>

        <span class="c1"># write list of models with spectra which are too small in a file:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;models_small_spectra&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">models_small_spectra</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># sort tracks:</span>
        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
            <span class="n">track</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># sanity check:</span>
        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">track</span><span class="o">.</span><span class="n">remove_duplicate_ages</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: the track </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">grid_params</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">params</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;         has models with the same age.  Removing duplicate models.&quot;</span><span class="p">)</span>

        <span class="c1"># update list of indices:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">))</span>

        <span class="c1"># need to create grid from scratch since tracks have been sorted.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">track</span><span class="o">.</span><span class="n">params</span> <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">])</span></div>


<div class="viewcode-block" id="Model_grid.replace_age_adim">
<a class="viewcode-back" href="../model.html#model.Model_grid.replace_age_adim">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">replace_age_adim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This replaces the dimensionless ages in the tracks according to the</span>
<span class="sd">        :py:data:`replace_age_adim` option chosen in ``AIMS_configure.py``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">replace_age_adim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">replace_age_adim</span> <span class="o">==</span> <span class="s2">&quot;age&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
                <span class="n">track</span><span class="o">.</span><span class="n">age_adim_to_age</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">replace_age_adim</span> <span class="o">==</span> <span class="s2">&quot;scale_age&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
                <span class="n">track</span><span class="o">.</span><span class="n">age_adim_to_scale_age</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">replace_age_adim</span> <span class="o">==</span> <span class="s2">&quot;scale_Xc&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
                <span class="n">track</span><span class="o">.</span><span class="n">age_adim_to_scale_Xc</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown option </span><span class="si">%s</span><span class="s2"> for replace_scale_age in AIMS_configure.py.&quot;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">replace_age_adim</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model_grid.check_age_adim">
<a class="viewcode-back" href="../model.html#model.Model_grid.check_age_adim">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_age_adim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This checks that all of the tracks are sorted according to dimensionless age</span>
<span class="sd">        parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">track</span><span class="o">.</span><span class="n">is_sorted_adim</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ERROR: track(s) not strictly sorted according to dimensionless age&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model_grid.range">
<a class="viewcode-back" href="../model.html#model.Model_grid.range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aParam</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find range of values for the input parameter.</span>

<span class="sd">        :param aParam: name of the parameter for which to find the range</span>
<span class="sd">        :type aParam: str</span>

<span class="sd">        .. warning::</span>
<span class="sd">         The input parameter can only be one of the grid parameters or an</span>
<span class="sd">         age/mHe parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">aParam</span> <span class="o">==</span> <span class="n">age_str</span><span class="p">):</span>
            <span class="n">param_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">age_lower</span>
            <span class="n">param_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">age_upper</span>

            <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">param_min</span> <span class="o">&gt;</span> <span class="n">track</span><span class="o">.</span><span class="n">age_lower</span><span class="p">):</span>
                    <span class="n">param_min</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">age_lower</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">param_max</span> <span class="o">&lt;</span> <span class="n">track</span><span class="o">.</span><span class="n">age_upper</span><span class="p">):</span>
                    <span class="n">param_max</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">age_upper</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">aParam</span><span class="p">)</span>
            <span class="n">param_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">param_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">param_min</span> <span class="o">&gt;</span> <span class="n">track</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">param_min</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">param_max</span> <span class="o">&lt;</span> <span class="n">track</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">param_max</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">param_min</span><span class="p">,</span> <span class="n">param_max</span><span class="p">]</span></div>


<div class="viewcode-block" id="Model_grid.tessellate">
<a class="viewcode-back" href="../model.html#model.Model_grid.tessellate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tessellate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply Delauny triangulation to obtain the grid tessellation.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distort_mat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distort_mat</span><span class="p">))</span></div>


<div class="viewcode-block" id="Model_grid.plot_tessellation">
<a class="viewcode-back" href="../model.html#model.Model_grid.plot_tessellation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_tessellation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the grid tessellation.</span>

<span class="sd">        .. warning::</span>
<span class="sd">          This only works for two-dimensional tessellations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only able to plot the tessellation in two dimensions.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># find bounds:</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span>
        <span class="n">xmin</span> <span class="o">-=</span> <span class="n">dx</span> <span class="o">*</span> <span class="mf">0.03</span>
        <span class="n">xmax</span> <span class="o">+=</span> <span class="n">dx</span> <span class="o">*</span> <span class="mf">0.03</span>
        <span class="n">ymin</span> <span class="o">-=</span> <span class="n">dy</span> <span class="o">*</span> <span class="mf">0.05</span>
        <span class="n">ymax</span> <span class="o">+=</span> <span class="n">dy</span> <span class="o">*</span> <span class="mf">0.05</span>

        <span class="c1"># plt.semilogy(self.grid[:,0],self.grid[:,1],&#39;o&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">triplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span><span class="o">.</span><span class="n">simplices</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">string_to_latex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">string_to_latex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;tessellation.eps&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model_grid.remove_tracks">
<a class="viewcode-back" href="../model.html#model.Model_grid.remove_tracks">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_tracks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nthreshold</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes stellar evolution tracks with fewer than nthreshold models.</span>

<span class="sd">        :param nthreshold: lower limit on number of models in a stellar</span>
<span class="sd">                           evolutionary track</span>
<span class="sd">        :type nthreshold: int</span>

<span class="sd">        :return: True if tracks have been removed and the grid needs to be</span>
<span class="sd">                 retessellated</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># easy exit:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nthreshold</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">removedTracks</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nthreshold</span><span class="p">):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">removedTracks</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># redo tessellation if need be</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">removedTracks</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I removed evolutionary tracks from the grid!&quot;</span><span class="p">)</span>

            <span class="c1"># update list of indices:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">))</span>

            <span class="c1"># need to create grid from scratch since tracks have been sorted.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">track</span><span class="o">.</span><span class="n">params</span> <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">removedTracks</span></div>


<div class="viewcode-block" id="Model_grid.distort_grid">
<a class="viewcode-back" href="../model.html#model.Model_grid.distort_grid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">distort_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define distortion matrix with which to distort grid to break its Cartesian</span>
<span class="sd">        character prior to tessellation.  This can cause find_simplex to run much</span>
<span class="sd">        faster.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">distort_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">make_scale_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">),</span> <span class="n">make_distort_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Distortion matrix condition number: </span><span class="si">%e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distort_mat</span><span class="p">)))</span></div>


<div class="viewcode-block" id="Model_grid.test_interpolation">
<a class="viewcode-back" href="../model.html#model.Model_grid.test_interpolation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test interpolation between different evolutionary tracks in a given grid.</span>

<span class="sd">        :return: The following four items are returned:</span>

<span class="sd">          - the interpolation errors</span>
<span class="sd">          - the first half of the partition (where the interpolation is tested)</span>
<span class="sd">          - the second half of the partition (used to carry out the interpolation)</span>
<span class="sd">          - the tessellation associated with the second half of the partition</span>

<span class="sd">        :rtype: np.array, list, list, tessellation object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ndx1</span><span class="p">,</span> <span class="n">ndx2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_partition</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distort_mat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">tessellation</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">ndx2</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tessellation</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">ndx2</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">distort_mat</span><span class="p">))</span>

        <span class="c1"># initialisation</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ndx1</span><span class="p">:</span>
            <span class="n">nmodels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">aResult</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nmodels</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">+</span> <span class="n">nglb</span> <span class="o">+</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmodels</span><span class="p">):</span>
                <span class="n">aModel1</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> \
                                <span class="n">_modes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> \
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">mode_indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">pt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">aModel1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iage</span><span class="p">]</span>
                <span class="n">aModel2</span> <span class="o">=</span> <span class="n">interpolate_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">ndx2</span><span class="p">)</span>
                <span class="n">aResult</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">ndim</span><span class="p">]</span> <span class="o">=</span> <span class="n">pt</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">aModel2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">aResult</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ndim</span><span class="p">:</span><span class="n">ndim</span> <span class="o">+</span> <span class="n">nglb</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">aResult</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ndim</span><span class="p">:</span><span class="n">ndim</span> <span class="o">+</span> <span class="n">nglb</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">compare_models</span><span class="p">(</span><span class="n">aModel1</span><span class="p">,</span> <span class="n">aModel2</span><span class="p">)</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aResult</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">ndx1</span><span class="p">,</span> <span class="n">ndx2</span><span class="p">,</span> <span class="n">tessellation</span></div>


<div class="viewcode-block" id="Model_grid.find_partition">
<a class="viewcode-back" href="../model.html#model.Model_grid.find_partition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_partition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a partition of the grid for use with :py:meth:`Model_grid.test_interpolation`</span>

<span class="sd">        :return: a random partition of [0 ... n-1] into two equal halves, where n is</span>
<span class="sd">                 the number of tracks in the grid</span>
<span class="sd">        :rtype: two lists of int</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ndx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">)))</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">ndx</span><span class="p">)</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">ndx</span><span class="p">[:</span><span class="n">nn</span><span class="p">],</span> <span class="n">ndx</span><span class="p">[</span><span class="n">nn</span><span class="p">:]</span></div>


<div class="viewcode-block" id="Model_grid.test_freq">
<a class="viewcode-back" href="../model.html#model.Model_grid.test_freq">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test to see if frequencies in all of the models of the grid</span>
<span class="sd">        are in ascending order for each l value.</span>

<span class="sd">        :return: The following items are returned</span>

<span class="sd">          - the effective temperatures of the models with frequencies out of order</span>
<span class="sd">          - the luminosities of the models with frequencies out of order</span>
<span class="sd">          - the effective temperatures of the models with sorted frequencies</span>
<span class="sd">          - the luminosities of the models with sorted frequencies</span>

<span class="sd">        :rtype: four lists of floats</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Teffs</span><span class="p">,</span> <span class="n">Lums</span><span class="p">,</span> <span class="n">Teffs_out</span><span class="p">,</span> <span class="n">Lums_out</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">names</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">track</span><span class="o">.</span><span class="n">freq_sorted</span><span class="p">(</span><span class="n">i</span><span class="p">)):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">Teffs_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">itemperature</span><span class="p">])</span>
                    <span class="n">Lums_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">iluminosity</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_luminosity</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Teffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">itemperature</span><span class="p">])</span>
                    <span class="n">Lums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">iluminosity</span><span class="p">]</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">solar_luminosity</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Teffs_out</span><span class="p">,</span> <span class="n">Lums_out</span><span class="p">,</span> <span class="n">Teffs</span><span class="p">,</span> <span class="n">Lums</span></div>


<div class="viewcode-block" id="Model_grid.find_epsilons">
<a class="viewcode-back" href="../model.html#model.Model_grid.find_epsilons">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_epsilons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltarget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find epsilon values in models from the grid</span>

<span class="sd">        :param ltarget: target l value for which epsilons are being obtained</span>
<span class="sd">        :type ltarget: int</span>

<span class="sd">        :return: the epsilon values</span>
<span class="sd">        :rtype: list of floats</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">epsilons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">names</span><span class="p">)):</span>
                <span class="n">epsilon</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">find_epsilon</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ltarget</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">epsilon</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="n">epsilons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">epsilons</span></div>
</div>



<div class="viewcode-block" id="init_user_param_dict">
<a class="viewcode-back" href="../model.html#model.init_user_param_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">init_user_param_dict</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialise the dictionaries which are related to user-defined parameters.  For</span>
<span class="sd">    a given parameter, these dictionaries provide the appropriate index for for</span>
<span class="sd">    the :py:data:`Model.glb` array as well as the appropriate latex name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">i</span> <span class="o">=</span> <span class="n">nlin</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">latex_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">user_params</span><span class="p">:</span>
        <span class="n">user_params_index</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">user_params_latex</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">latex_name</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="make_distort_matrix">
<a class="viewcode-back" href="../model.html#model.make_distort_matrix">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_distort_matrix</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.157</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a distortion matrix which can be used to make the grid more</span>
<span class="sd">    &quot;tessellation-friendly&quot;, i.e. which leads to much shorter computation</span>
<span class="sd">    times for finding simplices.</span>

<span class="sd">    :param d: number of dimensions</span>
<span class="sd">    :type d: int</span>

<span class="sd">    :param theta: a small angle</span>
<span class="sd">    :type theta: float</span>

<span class="sd">    :return: a distortion matrix</span>
<span class="sd">    :rtype: 2D float array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">sint</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
            <span class="n">aux</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">k</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">j</span><span class="p">)):</span>
                    <span class="k">continue</span>
                <span class="n">aux</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">aux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">aux</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost</span>
            <span class="n">aux</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">aux</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sint</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">aux</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mat</span></div>



<div class="viewcode-block" id="make_scale_matrix">
<a class="viewcode-back" href="../model.html#model.make_scale_matrix">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_scale_matrix</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a distortion matrix which can be used to make the grid more</span>
<span class="sd">    &quot;tessellation-friendly&quot;, i.e. which leads to much shorter computation</span>
<span class="sd">    times for finding simplices.</span>

<span class="sd">    :param grid: set of points used in the construction of the tessellation</span>
<span class="sd">    :type d: 2D float array</span>

<span class="sd">    :return: a distortion matrix</span>
<span class="sd">    :rtype: 2D float array</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-3</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">grid</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">bisect_right</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
        <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scale factor </span><span class="si">%d</span><span class="s2">: </span><span class="si">%e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">mat</span></div>



<div class="viewcode-block" id="combine_models">
<a class="viewcode-back" href="../model.html#model.combine_models">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">combine_models</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">coef1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">coef2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Do linear combination of this model with another.</span>

<span class="sd">    This method returns a new model which is the weighted sum</span>
<span class="sd">    of two models for the purposes of model interpolation.</span>
<span class="sd">    The classical parameters are combined in a self-consistent</span>
<span class="sd">    way as are the frequencies.</span>

<span class="sd">    :param model1: first model</span>
<span class="sd">    :param coef1:  weighting coefficient applied to first model</span>
<span class="sd">    :param model2: second model</span>
<span class="sd">    :param coef2:  weighting coefficient applied to second model</span>

<span class="sd">    :type model1: :py:class:`Model`</span>
<span class="sd">    :type coef1:  float</span>
<span class="sd">    :type model2: :py:class:`Model`</span>
<span class="sd">    :type coef2:  float</span>

<span class="sd">    :return: the combined model</span>
<span class="sd">    :rtype: :py:class:`Model`</span>

<span class="sd">    .. warning::</span>
<span class="sd">      One should avoid negative or zero coefficients as</span>
<span class="sd">      these could lead to undefined results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># find global parameters (try to be self-consistent):</span>

    <span class="c1"># this first part is simply a linear combination:</span>
    <span class="n">glb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nglb</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
    <span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nlin</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef1</span> <span class="o">*</span> <span class="n">model1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nlin</span><span class="p">]</span> <span class="o">+</span> <span class="n">coef2</span> <span class="o">*</span> <span class="n">model2</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nlin</span><span class="p">]</span>

    <span class="c1"># this next part depends on previous results:</span>
    <span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">coef1</span> <span class="o">*</span> <span class="n">model1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="n">model1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
                                  <span class="o">+</span> <span class="n">coef2</span> <span class="o">*</span> <span class="n">model2</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">imass</span><span class="p">]</span> <span class="o">/</span> <span class="n">model2</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
    <span class="n">cnst1</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iluminosity</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">model1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">itemperature</span><span class="p">]</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">cnst2</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iluminosity</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">model2</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">model2</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">itemperature</span><span class="p">]</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">glb</span><span class="p">[</span><span class="n">iluminosity</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">coef1</span> <span class="o">*</span> <span class="n">cnst1</span> <span class="o">+</span> <span class="n">coef2</span> <span class="o">*</span> <span class="n">cnst2</span><span class="p">)</span> <span class="o">*</span> <span class="n">glb</span><span class="p">[</span><span class="n">iradius</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">glb</span><span class="p">[</span><span class="n">itemperature</span><span class="p">]</span> <span class="o">**</span> <span class="mi">4</span>
    <span class="c1"># glb[ifreq_ref] will be correctly defined when the Model() constructor is invoked</span>

    <span class="c1"># interpolate spectra:</span>
    <span class="n">size3</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">nvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">size3</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ntype</span><span class="p">)</span>
    <span class="n">lvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">size3</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ltype</span><span class="p">)</span>
    <span class="n">fvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">size3</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ftype</span><span class="p">)</span>
    <span class="n">ivalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">size3</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ftype</span><span class="p">)</span>

    <span class="n">nvalues</span><span class="p">,</span> <span class="n">lvalues</span><span class="p">,</span> <span class="n">fvalues</span><span class="p">,</span> <span class="n">ivalues</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="n">aims_fortran</span><span class="o">.</span><span class="n">combine_modes</span><span class="p">(</span> \
        <span class="n">coef1</span><span class="p">,</span> <span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">],</span> <span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">],</span> <span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;inertia&#39;</span><span class="p">],</span> \
        <span class="n">coef2</span><span class="p">,</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">],</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">],</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;inertia&#39;</span><span class="p">],</span> \
        <span class="n">nvalues</span><span class="p">,</span> <span class="n">lvalues</span><span class="p">,</span> <span class="n">fvalues</span><span class="p">,</span> <span class="n">ivalues</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">glb</span><span class="p">,</span> <span class="n">_modes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n3</span><span class="p">],</span> <span class="n">lvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n3</span><span class="p">],</span> <span class="n">fvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n3</span><span class="p">],</span> <span class="n">ivalues</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n3</span><span class="p">])))</span></div>



<div class="viewcode-block" id="compare_models">
<a class="viewcode-back" href="../model.html#model.compare_models">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">compare_models</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare two models and find the largest frequency different for</span>
<span class="sd">    radial and non-radial modes.</span>

<span class="sd">    :param model1: first model</span>
<span class="sd">    :param model2: second model</span>

<span class="sd">    :type model1: :py:class:`Model`</span>
<span class="sd">    :type model2: :py:class:`Model`</span>

<span class="sd">    :return: a 1D array to be used in ``plot_test_interpolation.py``</span>
<span class="sd">      with the following measurements of the differences between the two models:</span>

<span class="sd">      - ``result[0]`` = maximum error on the radial modes</span>
<span class="sd">      - ``result[1]`` = RMS error on the radial modes</span>
<span class="sd">      - ``result[2]`` = RMS error on the radial modes near</span>
<span class="sd">        :math:`\\nu_{\\mathrm{max}}`</span>
<span class="sd">      - ``result[3]`` = maximum error on the non radial modes</span>
<span class="sd">      - ``result[4]`` = RMS error on the non radial modes</span>
<span class="sd">      - ``result[5]`` = RMS error on the non radial modes near</span>
<span class="sd">        :math:`\\nu_{\\mathrm{max}}`</span>
<span class="sd">      - ``result[6+[0:nglb]]`` = errors on the global parameters</span>

<span class="sd">    :rtype: np.array</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">interpolation_test_units</span> <span class="o">==</span> <span class="s2">&quot;microHz&quot;</span><span class="p">):</span>
        <span class="n">C1</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">],</span> <span class="n">model1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">interpolation_test_units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">C1</span> <span class="o">=</span> <span class="n">C2</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ERROR: Unrecognised units for interpolation_test_units in AIMS_configure.py&quot;</span><span class="p">)</span>

    <span class="c1"># initialisation:</span>
    <span class="n">n_radial</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_radial_numax</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_non_radial</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_non_radial_numax</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span> <span class="o">+</span> <span class="n">nglb</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
    <span class="c1"># define frequency interval around numax:</span>
    <span class="n">numax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">C1</span> <span class="o">*</span> <span class="n">model1</span><span class="o">.</span><span class="n">numax</span> <span class="o">/</span> <span class="n">model1</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">]</span> \
                   <span class="o">+</span> <span class="n">C2</span> <span class="o">*</span> <span class="n">model2</span><span class="o">.</span><span class="n">numax</span> <span class="o">/</span> <span class="n">model2</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="n">ifreq_ref</span><span class="p">])</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">numax</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">numax</span>

    <span class="c1"># compare frequency spectra:</span>
    <span class="n">size1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
    <span class="n">size2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">((</span><span class="n">i1</span> <span class="o">&lt;</span> <span class="n">size1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i2</span> <span class="o">&lt;</span> <span class="n">size2</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i2</span><span class="p">]):</span>
            <span class="n">i1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i2</span><span class="p">]):</span>
            <span class="n">i2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i2</span><span class="p">]):</span>
            <span class="n">i1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">i2</span><span class="p">]):</span>
            <span class="n">i2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">continue</span>

        <span class="c1"># now the two modes have the same n and l values:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">C1</span> <span class="o">*</span> <span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">-</span> <span class="n">C2</span> <span class="o">*</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i2</span><span class="p">])</span>
        <span class="n">avg_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">C1</span> <span class="o">*</span> <span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">+</span> <span class="n">C2</span> <span class="o">*</span> <span class="n">model2</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">][</span><span class="n">i2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">diff</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff</span>
            <span class="n">diff</span> <span class="o">*=</span> <span class="n">diff</span>  <span class="c1"># square diff</span>
            <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">diff</span>
            <span class="n">n_radial</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># in python, this is called an interval comparison:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">avg_freq</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">diff</span>
                <span class="n">n_radial_numax</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">diff</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff</span>
            <span class="n">diff</span> <span class="o">*=</span> <span class="n">diff</span>  <span class="c1"># square diff</span>
            <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="n">diff</span>
            <span class="n">n_non_radial</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">avg_freq</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+=</span> <span class="n">diff</span>
                <span class="n">n_non_radial_numax</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">i1</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">i2</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># avoid divisions by zero:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n_radial</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_radial</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n_radial_numax</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_radial_numax</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n_non_radial</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_non_radial</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n_non_radial_numax</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_non_radial_numax</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># absolute differences on global parameters:</span>
    <span class="n">result</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">6</span> <span class="o">+</span> <span class="n">nglb</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">glb</span> <span class="o">-</span> <span class="n">model2</span><span class="o">.</span><span class="n">glb</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="find_interpolation_coefficients">
<a class="viewcode-back" href="../model.html#model.find_interpolation_coefficients">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_interpolation_coefficients</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">ndx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find interpolation weights from the corresponding simplex.</span>

<span class="sd">    Linear interpolation weights are obtained with the simplex</span>
<span class="sd">    by finding the barycentric coordinates of the point given</span>
<span class="sd">    by ``pt``.</span>

<span class="sd">    :param grid: grid of models in which we&#39;re carrying out the</span>
<span class="sd">      interpolation</span>
<span class="sd">    :param pt: set of parameters used for finding the</span>
<span class="sd">      interpolation weights.  The first part contains the grid</span>
<span class="sd">      parameters (relevant to this interpolation), whereas</span>
<span class="sd">      the last element is the age (not used here).  If the</span>
<span class="sd">      provided set of parameters lies outside the grid, then</span>
<span class="sd">      ``None`` is returned instead of an interpolated model.</span>
<span class="sd">    :param tessellation: tessellation with which to carry out the</span>
<span class="sd">      interpolation.</span>
<span class="sd">    :param ndx: indices of the grid points associated with the</span>
<span class="sd">      tessellation</span>

<span class="sd">    :type grid: :py:class:`Model_grid`</span>
<span class="sd">    :type pt: array-like</span>
<span class="sd">    :type tessellation: Delaunay tessellation object</span>
<span class="sd">    :type ndx: list of int</span>

<span class="sd">    :return: lists of interpolation coefficients and tracks</span>
<span class="sd">    :rtype: list of floats, list of :py:class:`Track`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tessellation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">distort_mat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">pt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">),</span> <span class="n">grid</span><span class="o">.</span><span class="n">distort_mat</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">tessellation</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">pt1</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ndim</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># see if point is outside tessellation</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">tessellation</span><span class="o">.</span><span class="n">transform</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>

    <span class="c1"># make sure the transformation matrix is defined:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mat</span><span class="p">))):</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[:</span><span class="n">grid</span><span class="o">.</span><span class="n">ndim</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pt1</span> <span class="o">-</span> <span class="n">mat</span><span class="p">[</span><span class="n">grid</span><span class="o">.</span><span class="n">ndim</span><span class="p">])</span>
    <span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">sum</span><span class="p">()]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">tessellation</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>

    <span class="c1"># check to make sure you&#39;re not outside the grid:</span>
    <span class="k">for</span> <span class="n">coef</span> <span class="ow">in</span> <span class="n">coefs</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">coef</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">tol</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># produce results, filtering out zero elements:</span>
    <span class="n">coefs_out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="c1"># remove negative coefficients to avoid problems.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">coef</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">coefs_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
            <span class="n">tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">ndx</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">coefs_out</span><span class="p">,</span> <span class="n">tracks</span></div>



<div class="viewcode-block" id="find_ages">
<a class="viewcode-back" href="../model.html#model.find_ages">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_ages</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">tracks</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find ages to which each track needs to be interpolated for a specified</span>
<span class="sd">    age.  The variable :py:data:`age_interpolation` in AIMS_configure.py</span>
<span class="sd">    decides between the following options:</span>

<span class="sd">    1. ``age_interpolation`` = ``age``: each track is simply interpolated</span>
<span class="sd">       to ``age``.</span>
<span class="sd">    2. ``age_interpolation`` = ``scale_age``: the age of each model along</span>
<span class="sd">       each evolutionary track, including the interpolated track, is</span>
<span class="sd">       linearly mapped onto the interval [0,1].  A dimensionless parameter</span>
<span class="sd">       ``eta`` is obtained by interpolating ``age`` onto the interval</span>
<span class="sd">       [0,1], using the linear transformation associated with the</span>
<span class="sd">       interpolated track.  Using the parameter eta, a corresponding age</span>
<span class="sd">       is obtained along each track.</span>
<span class="sd">    3. ``age_interpolation`` = ``age_adim``: each track is interpolated</span>
<span class="sd">       to the appropriate dimensionless age so that the interpolated</span>
<span class="sd">       physical age reproduces the input age.  This dimensionless age</span>
<span class="sd">       parameter is calculated via a fortran subroutine.</span>

<span class="sd">    .. figure:: ./figures/age_interpolation.*</span>
<span class="sd">      :figclass: align-center</span>

<span class="sd">      This diagram illustrates age interpolation for the two</span>
<span class="sd">      first options, namely ``age`` and ``scale_age``, and shows</span>
<span class="sd">      the advantages of selecting the latter.</span>

<span class="sd">    :param coefs: interpolation coefficients used to weight each track.</span>
<span class="sd">    :param tracks:  evolutionary tracks involved in the interpolation.</span>
<span class="sd">    :param age: target age for the output interpolated model.</span>

<span class="sd">    :type coefs: list of floats</span>
<span class="sd">    :type tracks:  list of :py:class:`Track`</span>
<span class="sd">    :type age: float</span>

<span class="sd">    :return: the relevant age for each track</span>
<span class="sd">    :rtype: list of floats</span>

<span class="sd">    .. note::</span>
<span class="sd">      - the interpolation coefficients should add up to 1.0</span>
<span class="sd">      - there should be as many tracks as interpolation coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tracks</span><span class="p">)),</span> <span class="s2">&quot;Mismatch between len(coefs) and len(tracks)&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">age_interpolation</span> <span class="o">==</span> <span class="s2">&quot;age&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">age</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">age_interpolation</span> <span class="o">==</span> <span class="s2">&quot;scale_age&quot;</span><span class="p">):</span>
        <span class="n">age_s</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">age_f</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">track</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">tracks</span><span class="p">):</span>
            <span class="n">age_s</span> <span class="o">+=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">track</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span>
            <span class="n">age_f</span> <span class="o">+=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">track</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span>

        <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="n">age</span> <span class="o">-</span> <span class="n">age_s</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">age_f</span> <span class="o">-</span> <span class="n">age_s</span><span class="p">)</span>

        <span class="c1"># check to see if the age lies within the interpolated track:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eta</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eta</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">ages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">track</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">tracks</span><span class="p">):</span>
            <span class="n">ages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="n">track</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">iage</span><span class="p">]</span> <span class="o">+</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">track</span><span class="o">.</span><span class="n">glb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iage</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ages</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">age_interpolation</span> <span class="o">==</span> <span class="s2">&quot;age_adim&quot;</span><span class="p">):</span>

        <span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="n">ntracks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tracks</span><span class="p">)</span>
        <span class="n">sze</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">track</span><span class="o">.</span><span class="n">glb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">max_sze</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sze</span><span class="p">)</span>
        <span class="n">age_adim_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">max_sze</span><span class="p">,</span> <span class="n">ntracks</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
        <span class="n">age_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">max_sze</span><span class="p">,</span> <span class="n">ntracks</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntracks</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntracks</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">age_adim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># this is important to catch failures</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntracks</span><span class="p">):</span>
            <span class="n">nmodels</span> <span class="o">=</span> <span class="n">sze</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">age_array</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nmodels</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage</span><span class="p">]</span>
            <span class="n">age_adim_array</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nmodels</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">glb</span><span class="p">[:,</span> <span class="n">iage_adim</span><span class="p">]</span>

        <span class="n">age_adim</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">aims_fortran</span><span class="o">.</span><span class="n">find_tau</span><span class="p">(</span><span class="n">age_adim_array</span><span class="p">,</span> \
                                                           <span class="n">age_array</span><span class="p">,</span> <span class="n">coefs</span><span class="p">,</span> <span class="n">sze</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">age_adim</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">age_adim</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">ages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntracks</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntracks</span><span class="p">):</span>
            <span class="n">ages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">age_array</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> \
                      <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">age_array</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ages</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognised age_interpolation option </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">age_interpolation</span><span class="p">)</span></div>



<div class="viewcode-block" id="interpolate_model">
<a class="viewcode-back" href="../model.html#model.interpolate_model">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">interpolate_model</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">ndx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolate model in grid using provided parameters.</span>

<span class="sd">    The interpolation is carried out in two steps.  First, linear</span>
<span class="sd">    interpolation according to age is carried out on each node of</span>
<span class="sd">    the simplex containing the set of parameters.  This interpolation</span>
<span class="sd">    is done using the :py:class:`Track.interpolate_model` method.</span>
<span class="sd">    Then, linear interpolation is carried out within the simplex.</span>
<span class="sd">    This achieved by finding the barycentric coordinates of the</span>
<span class="sd">    model (i.e. the weights), before combining the age-interpolated</span>
<span class="sd">    models form the nodes using the :py:class:`combine_models` method.</span>
<span class="sd">    In this manner, the weights are only calculated once, thereby</span>
<span class="sd">    increasing computational efficiency.</span>

<span class="sd">    :param grid: grid of models in which we&#39;re carrying out the</span>
<span class="sd">      interpolation</span>
<span class="sd">    :param pt: set of parameters used for the interpolation.</span>
<span class="sd">      The first part contains the grid parameters, whereas</span>
<span class="sd">      the last element is the age.  If the provided set</span>
<span class="sd">      of parameters lies outside the grid, then ``None``</span>
<span class="sd">      is returned instead of an interpolated model.</span>
<span class="sd">    :param tessellation: tessellation with which to carry out the</span>
<span class="sd">      interpolation.</span>
<span class="sd">    :param ndx: indices of the grid points associated with the</span>
<span class="sd">      tessellation</span>

<span class="sd">    :type grid: :py:class:`Model_grid`</span>
<span class="sd">    :type pt: array-like</span>
<span class="sd">    :type tessellation: Delaunay tessellation object</span>
<span class="sd">    :type ndx: list of int</span>

<span class="sd">    :return: the interpolated model</span>
<span class="sd">    :rtype: :py:class:`Model`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># find simplex interpolation coefficients</span>
    <span class="n">coefs</span><span class="p">,</span> <span class="n">tracks</span> <span class="o">=</span> <span class="n">find_interpolation_coefficients</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">ndx</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">coefs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># find ages:</span>
    <span class="n">ages</span> <span class="o">=</span> <span class="n">find_ages</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">tracks</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ages</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tracks</span><span class="p">)</span>

    <span class="c1"># treat the case where there is only 1 model:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: erroneous interpolation coefficient: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate_model</span><span class="p">(</span><span class="n">ages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># treat the case where there are at least 2 models:</span>
    <span class="n">aModel1</span> <span class="o">=</span> <span class="n">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate_model</span><span class="p">(</span><span class="n">ages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">aModel1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">aModel2</span> <span class="o">=</span> <span class="n">tracks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate_model</span><span class="p">(</span><span class="n">ages</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">aModel2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">aModel1</span> <span class="o">=</span> <span class="n">combine_models</span><span class="p">(</span><span class="n">aModel1</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">aModel2</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">aModel2</span> <span class="o">=</span> <span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate_model</span><span class="p">(</span><span class="n">ages</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aModel2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">aModel1</span> <span class="o">=</span> <span class="n">combine_models</span><span class="p">(</span><span class="n">aModel1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">aModel2</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">aModel1</span></div>



<div class="viewcode-block" id="find_combination">
<a class="viewcode-back" href="../model.html#model.find_combination">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_combination</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find linear combination of models which corresponds to interpolating</span>
<span class="sd">    the model based on the provided parameters.</span>

<span class="sd">    The interpolation is carried out using the same procedure as in</span>
<span class="sd">    :py:func:`interpolate_model`.</span>

<span class="sd">    :param grid: grid of models in which we&#39;re carrying out the</span>
<span class="sd">      interpolation</span>
<span class="sd">    :param pt: set of parameters used for the interpolation.</span>
<span class="sd">      The first part contains the grid parameters, whereas</span>
<span class="sd">      the last element is the age.  If the provided set</span>
<span class="sd">      of parameters lies outside the grid, then ``None``</span>
<span class="sd">      is returned instead of an interpolated model.</span>

<span class="sd">    :type grid: :py:class:`Model_grid`</span>
<span class="sd">    :type pt: array-like</span>

<span class="sd">    :return: pairs of coefficients and model names</span>
<span class="sd">    :rtype: tuple of (float,string)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># find simplex interpolation coefficients</span>
    <span class="n">coefs</span><span class="p">,</span> <span class="n">tracks</span> <span class="o">=</span> <span class="n">find_interpolation_coefficients</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ndx</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">coefs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># find ages:</span>
    <span class="n">ages</span> <span class="o">=</span> <span class="n">find_ages</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">tracks</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ages</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tracks</span><span class="p">)</span>

    <span class="c1"># combine multiple models:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">age</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">tracks</span><span class="p">,</span> <span class="n">ages</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">coef</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>  <span class="c1"># make sure we&#39;re not outside the grid</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">find_combination</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">results</span> <span class="o">+=</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">results</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Daniel R. Reese.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>